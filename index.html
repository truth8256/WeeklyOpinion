<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 프레젠테이션 슬라이드 (총 4페이지)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
        }

        /* ⭐️ 프레젠테이션 뷰를 감싸는 래퍼 (고정 크기 유지) */
        .presentation-wrapper {
            width: 960px;
            height: 540px;
            position: relative; 
        }

        /* 슬라이드 컨테이너 */
        .slide-container {
            width: 100%;
            height: 100%;
            background-color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: absolute; 
            top: 0;
            left: 0;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s, visibility 0.3s;
        }

        /* 숨겨진 슬라이드 */
        .slide-container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* 최소화된 슬라이드 내비게이터 (슬라이드 바깥 우측 하단) */
        .slide-navigator {
            position: absolute;
            bottom: -40px; 
            right: 0;      
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 20;   
        }

        .nav-arrow {
            background: none;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
        }

        .nav-arrow:hover:not(:disabled) {
            background-color: #e9ecef;
            border-color: #c0c0c0;
        }

        .nav-arrow:disabled {
            color: #ccc;
            cursor: default;
            border-color: #eee;
        }

        #page-indicator {
            font-size: 14px;
            color: #666;
        }

        /* 기존 스타일 유지 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 15px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .title {
            font-size: 24px;
            font-weight: 800;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #e9ecef;
        }

        .btn.active {
            background-color: #0056b3;
            color: white;
            border-color: #0056b3;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        /* ⭐️ 푸터 스타일 제거 */

    </style>
</head>
<body>

    <div class="presentation-wrapper">
        
        <div class="slide-navigator">
            <button id="nav-prev" class="nav-arrow" onclick="navigateSlides(-1)" disabled>&lt;</button>
            <span id="page-indicator">1 / 4</span>
            <button id="nav-next" class="nav-arrow" onclick="navigateSlides(1)">&gt;</button>
        </div>

        <div id="pres-slide-full" class="slide-container">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div> 

            <div class="chart-wrapper">
                <canvas id="presChartFull"></canvas>
            </div>

        </div>

        <div id="party-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div>

            <div class="chart-wrapper">
                <canvas id="partyChartFull"></canvas>
            </div>

        </div>

        <div id="pres-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별통합, 긍정) - 세부 비교</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="pres-controls" class="controls">
                <button class="btn active" onclick="updatePresView('total', this)">전체 보기</button>
                <button class="btn" onclick="updatePresView('gender', this)">성별</button>
                <button class="btn" onclick="updatePresView('age', this)">연령별</button>
                <button class="btn" onclick="updatePresView('region_main', this)">주요 지역별</button>
                <button class="btn" onclick="updatePresView('gender_age_2030', this)">성/연령별 (2030)</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="presChart"></canvas>
            </div>

        </div>

        <div id="party-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (민주당, 국민의힘, 무당층) - 세부</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="party-controls" class="controls">
                <button class="btn active" disabled>전체 보기</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="partyChart"></canvas>
            </div>

        </div>

    </div>

    <script>
        // 전체 기간 (7월, 8월, 9월, 10월, 11월)
        const labelsFull = ['7월', '8월', '9월', '10월', '11월'];
        // 기존 기간 (9월, 10월, 11월)
        const labelsPartial = ['9월', '10월', '11월'];
        
        // --- 차트 데이터 및 객체 ---
        let presChartFull = null; // 1페이지 차트
        let partyChartFull = null; // 2페이지 차트
        let presChart = null; // 3페이지 차트
        let partyChart = null; // 4페이지 차트

        const pres_controls = document.getElementById('pres-controls');
        
        // ⭐️ 슬라이드 순서 및 상태 관리 (총 4개)
        const slideOrder = ['pres-slide-full', 'party-slide-full', 'pres-slide', 'party-slide'];
        let currentSlideIndex = 0;
        const pageIndicator = document.getElementById('page-indicator');
        const navPrev = document.getElementById('nav-prev');
        const navNext = document.getElementById('nav-next');


        // ===========================================================
        // ⭐️ NEW 1, 2 페이지 데이터 (7월~11월, 5개월 추이) - 수정 반영됨
        // ===========================================================

        // [1페이지: 직무 평가 전체 데이터 - 긍정/부정]
        const pres_data_Full = [
            { 
                label: '긍정 평가', 
                data: [64, 58, 59, 56, 60], // 7월, 8월(New), 9월, 10월, 11월
                borderColor: '#0056b3',
                backgroundColor: '#0056b3',
                borderWidth: 3,
                pointRadius: 6,
                pointHoverRadius: 8,
                tension: 0,
                order: 1
            },
            {
                label: '부정 평가',
                data: [23, 32, 32, 34, 30], // 7월, 8월(New), 9월, 10월, 11월
                borderColor: '#C9151E',
                backgroundColor: '#C9151E',
                borderWidth: 3,
                pointRadius: 6,
                pointHoverRadius: 8,
                tension: 0,
                order: 2
            }
        ];

        // [2페이지: 정당 지지율 데이터 - 7월 포함, 수정된 값]
        const partyData_Full = [
            // 7월: 45% (수정됨)
            { label: '민주당', data: [45, 43, 40, 41, 42], borderColor: '#0056b3', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 }, 
            // 7월: 20% (수정됨)
            { label: '국민의힘', data: [20, 23, 24, 25, 25], borderColor: '#C9151E', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 }, 
            // 7월: 25% (수정됨)
            { label: '무당층', data: [25, 25, 27, 26, 26], borderColor: '#666666', borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 } 
        ];

        // ===========================================================
        // 3, 4 페이지 데이터 (9월~11월, 3개월 추이)
        // ===========================================================

        // [3페이지: 직무 평가 세부 카테고리 (9~11월)]
        const pres_totalData_Partial = {
            label: '직무 평가 전체',
            data: [59, 56, 60], // 9월, 10월, 11월 (긍정 평가만 표시)
            borderColor: '#000000',
            backgroundColor: '#000000',
            borderWidth: 2,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0,
            order: 1
        };
        
        const pres_categories_Partial = {
            'total': [],
            'gender': [
                { label: '남성', data: [56, 56, 60], borderColor: '#36A2EB', borderWidth: 2 },
                { label: '여성', data: [62, 56, 61], borderColor: '#FF6384', borderWidth: 2 }
            ],
            'age': [
                { label: '18~29세', data: [43, 41, 51], borderColor: '#4BC0C0', borderWidth: 2 },
                { label: '30대', data: [62, 51, 57], borderColor: '#FF9F40', borderWidth: 2 },
                { label: '40대', data: [75, 74, 76], borderColor: '#9966FF', borderWidth: 2 },
                { label: '50대', data: [71, 70, 72], borderColor: '#FFCD56', borderWidth: 2 },
                { label: '60대', data: [53, 47, 55], borderColor: '#C9CBCF', borderWidth: 2 },
                { label: '70대 이상', data: [44, 46, 47], borderColor: '#8c8c8c', borderWidth: 2, borderDash: [5, 5] }
            ],
            'region_main': [
                { label: '서울', data: [60, 50, 61], borderColor: '#E91E63', borderWidth: 3 },
                { label: '인천/경기', data: [61, 58, 60], borderColor: '#3F51B5', borderWidth: 2 },
                { label: '대구/경북', data: [41, 40, 45], borderColor: '#009688', borderWidth: 2 },
                { label: '부산/울산/경남', data: [51, 52, 56], borderColor: '#795548', borderWidth: 2 },
                { label: '광주/전라', data: [84, 80, 85], borderColor: '#4CAF50', borderWidth: 2, borderDash: [5, 5] }
            ],
            'gender_age_2030': [
                { label: '남성 20대', data: [30, 32, 45], borderColor: '#2980b9', borderWidth: 2, borderDash: [5, 2] },
                { label: '여성 20대', data: [57, 52, 58], borderColor: '#e74c3c', borderWidth: 2, borderDash: [5, 2] },
                { label: '남성 30대', data: [52, 48, 52], borderColor: '#3498db', borderWidth: 2 },
                { label: '여성 30대', data: [74, 55, 63], borderColor: '#e67e22', borderWidth: 2 }
            ]
        };
        
        // [4페이지: 정당 지지율 (9~11월)]
        const partyData_Partial = [
            { label: '민주당', data: [40, 41, 42], borderColor: '#0056b3', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
            { label: '국민의힘', data: [24, 25, 25], borderColor: '#C9151E', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 },
            { label: '무당층', data: [27, 26, 26], borderColor: '#666666', borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 }
        ];


        // ⭐️ 차트 초기화 함수 (재사용)
        function initChart(canvasId, labels, initialDatasets, yMin, yMax) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // 1, 2 페이지에만 Data Labels 플러그인 적용
            const useDataLabels = (canvasId === 'presChartFull' || canvasId === 'partyChartFull');
            
            const plugins = {
                legend: { position: 'right', align: 'start', labels: { usePointStyle: true, boxWidth: 8, padding: 15 } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ' + context.parsed.y + '%';
                        }
                    }
                }
            };

            // Data Labels 플러그인 설정
            if (useDataLabels) {
                plugins.datalabels = {
                    align: function(context) {
                        // '국민의힘' 데이터셋일 경우 'bottom' 정렬
                        if (context.dataset.label === '국민의힘') {
                            return 'bottom';
                        }
                        // 그 외 데이터셋 (긍정 평가, 부정 평가, 민주당, 무당층)은 'top' 정렬
                        return 'top';
                    },
                    font: {
                        size: 12
                    },
                    formatter: function(value, context) {
                        return value + '%';
                    }
                };
            }

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: initialDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    layout: { padding: { left: 10, right: 20, top: useDataLabels ? 20 : 10 } }, // 데이터 레이블 공간 확보
                    plugins: plugins,
                    scales: {
                        y: {
                            min: yMin, 
                            max: yMax, 
                            grid: { color: '#e0e0e0', drawBorder: false },
                            ticks: { stepSize: 10, font: { size: 11 } }
                        },
                        x: {
                            offset: true,
                            grid: { display: false },
                            ticks: { font: { size: 12 } }
                        }
                    },
                    elements: {
                        line: { tension: 0 }
                    }
                },
                // 플러그인 등록 (1, 2 페이지에만 적용되도록 옵션에서 분리)
                plugins: useDataLabels ? [ChartDataLabels] : []
            });
        }
        
        // ⭐️ 슬라이드 전환 및 표시 업데이트 (이하 동일)
        function updateSlideDisplay(index) {
            document.querySelectorAll('.slide-container').forEach(slide => {
                slide.classList.add('hidden');
            });
            
            const slideId = slideOrder[index];
            document.getElementById(slideId).classList.remove('hidden');

            pageIndicator.textContent = `${index + 1} / ${slideOrder.length}`;

            navPrev.disabled = (index === 0);
            navNext.disabled = (index === slideOrder.length - 1);

            // 차트 렌더링
            switch(slideId) {
                case 'pres-slide-full':
                    // 1페이지 (7~11월 긍정/부정)
                    if (!presChartFull) presChartFull = initChart('presChartFull', labelsFull, pres_data_Full, 0, 90); // Y축 범위 0~90
                    else presChartFull.update();
                    break;
                case 'party-slide-full':
                    // 2페이지 (7~11월 정당 지지율)
                    if (!partyChartFull) partyChartFull = initChart('partyChartFull', labelsFull, partyData_Full, 0, 50);
                    else partyChartFull.update();
                    break;
                case 'pres-slide':
                    // 3페이지 (9~11월 직무 평가 세부)
                    const currentActiveBtn = pres_controls.querySelector('.btn.active');
                    updatePresView(currentActiveBtn ? currentActiveBtn.dataset.mode || 'total' : 'total', currentActiveBtn);
                    break;
                case 'party-slide':
                    // 4페이지 (9~11월 정당 지지율)
                    if (!partyChart) partyChart = initChart('partyChart', labelsPartial, partyData_Partial, 0, 50);
                    else partyChart.update();
                    break;
            }
        }

        // ⭐️ 화살표를 통한 슬라이드 이동 함수
        function navigateSlides(direction) {
            let newIndex = currentSlideIndex + direction;

            if (newIndex >= 0 && newIndex < slideOrder.length) {
                currentSlideIndex = newIndex;
                updateSlideDisplay(currentSlideIndex);
            }
        }
        
        // 3페이지: 직무 평가 차트 데이터 업데이트 (카테고리 버튼 클릭 시)
        function updatePresView(mode, btnElement) {
            pres_controls.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            if(btnElement) {
                btnElement.classList.add('active');
                btnElement.dataset.mode = mode; // 모드를 버튼에 저장
            }

            // 3페이지는 긍정 평가 '전체' 또는 '전체' + '세부 카테고리'를 보여줌
            const newDatasets = [pres_totalData_Partial]; 

            if (pres_categories_Partial[mode]) {
                pres_categories_Partial[mode].forEach(ds => {
                    newDatasets.push(Object.assign({}, ds, {
                        tension: 0,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        order: 2
                    }));
                });
            }
            
            if (!presChart) {
                // 차트 초기화 (Y축 범위 20~90)
                presChart = initChart('presChart', labelsPartial, newDatasets, 20, 90);
            } else {
                // 차트 데이터 업데이트
                presChart.data.datasets = newDatasets;
                presChart.update();
            }
        }

        // 초기 로드 시 첫 번째 슬라이드 활성화
        document.addEventListener('DOMContentLoaded', () => {
            updateSlideDisplay(currentSlideIndex);
        });

    </script>
</body>
</html>