<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 프레젠테이션 슬라이드 (총 6페이지)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
        }

        /* ⭐️ 프레젠테이션 뷰를 감싸는 래퍼 (고정 크기 유지) */
        .presentation-wrapper {
            width: 960px;
            height: 540px;
            position: relative; 
        }

        /* 슬라이드 컨테이너 */
        .slide-container {
            width: 100%;
            height: 100%;
            background-color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: absolute; 
            top: 0;
            left: 0;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s, visibility 0.3s;
        }

        /* 숨겨진 슬라이드 */
        .slide-container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* 최소화된 슬라이드 내비게이터 (슬라이드 바깥 우측 하단) */
        .slide-navigator {
            position: absolute;
            bottom: -40px; 
            right: 0;     
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 20;   
        }

        .nav-arrow {
            background: none;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
        }

        .nav-arrow:hover:not(:disabled) {
            background-color: #e9ecef;
            border-color: #c0c0c0;
        }

        .nav-arrow:disabled {
            color: #ccc;
            cursor: default;
            border-color: #eee;
        }

        #page-indicator {
            font-size: 14px;
            color: #666;
        }

        /* 기존 스타일 유지 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 15px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .title {
            font-size: 24px;
            font-weight: 800;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #e9ecef;
        }

        .btn.active {
            background-color: #0056b3;
            color: white;
            border-color: #0056b3;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100%;
        }
        
    </style>
</head>
<body>

    <div class="presentation-wrapper">
        
        <div class="slide-navigator">
            <button id="nav-prev" class="nav-arrow" onclick="navigateSlides(-1)" disabled>&lt;</button>
            <span id="page-indicator">1 / 6</span>
            <button id="nav-next" class="nav-arrow" onclick="navigateSlides(1)">&gt;</button>
        </div>

        <div id="weekly-trend-slide" class="slide-container">
            <div class="header">
                <div id="weekly-trend-title" class="title">대통령 직무 수행 평가 추이 (갤럽)</div>
                <div class="subtitle">기간: 주간 단위 | 자료: 갤럽/리얼미터</div>
            </div>

            <div id="weekly-trend-controls" class="controls">
                <button class="btn active" data-mode="gallup" onclick="updateWeeklyTrendView('gallup', this)">갤럽</button>
                <button class="btn" data-mode="realmeter" onclick="updateWeeklyTrendView('realmeter', this)">리얼미터</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="weeklyTrendChart"></canvas>
            </div>
        </div>

        <div id="party-trend-slide" class="slide-container hidden">
            <div class="header">
                <div id="party-trend-title" class="title">주요 정당 지지율 추이 (갤럽)</div>
                <div class="subtitle">기간: 주간 단위 | 자료: 갤럽/리얼미터</div>
            </div>

            <div id="party-trend-controls" class="controls">
                <button class="btn active" data-mode="gallup" onclick="updateWeeklyPartyTrendView('gallup', this)">갤럽</button>
                <button class="btn" data-mode="realmeter" onclick="updateWeeklyPartyTrendView('realmeter', this)">리얼미터</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="weeklyPartyTrendChart"></canvas>
            </div>
        </div>
        <div id="pres-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div> 

            <div class="chart-wrapper">
                <canvas id="presChartFull"></canvas>
            </div>
        </div>

        <div id="party-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div>

            <div class="chart-wrapper">
                <canvas id="partyChartFull"></canvas>
            </div>
        </div>

        <div id="pres-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별통합, 긍정) - 세부 비교</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="pres-controls" class="controls">
                <button class="btn active" data-mode="total" onclick="updatePresView('total', this)">전체 보기</button>
                <button class="btn" data-mode="gender" onclick="updatePresView('gender', this)">성별</button>
                <button class="btn" data-mode="age" onclick="updatePresView('age', this)">연령별</button>
                <button class="btn" data-mode="region_main" onclick="updatePresView('region_main', this)">주요 지역별</button>
                <button class="btn" data-mode="gender_age_2030" onclick="updatePresView('gender_age_2030', this)">성/연령별 (2030)</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="presChart"></canvas>
            </div>

        </div>

        <div id="party-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (민주당, 국민의힘, 무당층) - 세부</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="party-controls" class="controls">
                <button class="btn active" disabled>전체 보기</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="partyChart"></canvas>
            </div>
        </div>

    </div>

    <script>
        // -----------------------------------------------------------
        // ⭐️ 전역 설정 및 상수 (색상 통일 적용)
        // -----------------------------------------------------------
        
        // Chart.js 전역 폰트 설정 (한글 깨짐 방지 및 폰트 통일)
        Chart.defaults.font.family = 'Pretendard, sans-serif';
        Chart.defaults.font.size = 12;
        
        // ⭐️ 사용할 색상 정의 (presChartFull 기준)
        const POSITIVE_COLOR = '#0056b3';   // 파란색 (긍정, 더불어민주당)
        const NEGATIVE_COLOR = '#C9151E';   // 빨간색 (부정, 국민의힘)
        const JO_GUK_COLOR = '#0073CF';     // cobalt색 (조국혁신당)
        const REFORM_COLOR = '#F38400';     // 주황색 (개혁신당)
        const PROGRESSIVE_COLOR = '#450693';// 보라색 (진보당)
        const NON_PARTISAN_COLOR = '#666666'; // 회색 (무당층)

        // DataLabels 플러그인 등록
        Chart.register(ChartDataLabels); 

        // 전체 기간 (7월, 8월, 9월, 10월, 11월)
        const labelsFull = ['7월', '8월', '9월', '10월', '11월'];
        // 기존 기간 (9월, 10월, 11월)
        const labelsPartial = ['9월', '10월', '11월'];
        
        // --- 차트 데이터 및 객체 ---
        let presChartFull = null; 
        let partyChartFull = null; 
        let presChart = null; 
        let partyChart = null; 
        let weeklyTrendChart = null; // 1페이지: 주간 국정수행평가 차트 객체
        let weeklyTrendData = {};    // 1페이지: 주간 국정수행평가 데이터 저장소
        let weeklyPartyTrendChart = null; // ⭐️ 2페이지: 주간 정당 지지율 차트 객체
        let weeklyPartyTrendData = {};    // ⭐️ 2페이지: 주간 정당 지지율 데이터 저장소
        
        const pres_controls = document.getElementById('pres-controls');
        
        // ⭐️ 슬라이드 순서 및 상태 관리 (총 6개로 증가)
        // [1] 직무 주간, [2] 정당 주간, [3] 직무 월간, [4] 정당 월간, [5] 직무 세부, [6] 정당 세부
        const slideOrder = ['weekly-trend-slide', 'party-trend-slide', 'pres-slide-full', 'party-slide-full', 'pres-slide', 'party-slide'];
        let currentSlideIndex = 0;
        const pageIndicator = document.getElementById('page-indicator');
        const navPrev = document.getElementById('nav-prev');
        const navNext = document.getElementById('nav-next');


        // ===========================================================
        // 1페이지: 대통령 직무 수행 평가 주간 로직 (기존 유지)
        // ===========================================================

        function parseCombinedCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const labels = [];
            const gallupData = { good: [], bad: [] };
            const realmeterData = { good: [], bad: [] };

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    labels.push(values[0].trim());
                    realmeterData.good.push(parseFloat(values[1].trim()));
                    realmeterData.bad.push(parseFloat(values[2].trim()));
                    gallupData.good.push(parseInt(values[4].trim()));
                    gallupData.bad.push(parseInt(values[5].trim()));
                }
            }
            return { labels, gallupData, realmeterData };
        }

        function loadWeeklyTrendChart() {
            const DATA_URL = './data/presidential_approval_real_gal.csv'; 

            fetch(DATA_URL)
                .then(response => response.ok ? response.text() : Promise.reject('주간 직무 데이터 로드 실패: ' + response.statusText))
                .then(csvText => {
                    weeklyTrendData = parseCombinedCSV(csvText);
                    updateWeeklyTrendView('gallup', document.querySelector('#weekly-trend-controls .btn.active'));
                })
                .catch(error => console.error("주간 직무 데이터 로드 오류:", error));
        }

        function updateWeeklyTrendView(mode, btnElement) {
            if (!weeklyTrendData.labels) return; 

            document.querySelectorAll('#weekly-trend-controls .btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
            }

            const isGallup = mode === 'gallup';
            const source = isGallup ? weeklyTrendData.gallupData : weeklyTrendData.realmeterData;
            document.getElementById('weekly-trend-title').textContent = `대통령 직무 수행 평가 추이 (${isGallup ? '갤럽' : '리얼미터'})`;

            const newDatasets = [
                { label: '긍정', data: source.good, borderColor: POSITIVE_COLOR, backgroundColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
                { label: '부정', data: source.bad, borderColor: NEGATIVE_COLOR, backgroundColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 }
            ];

            if (!weeklyTrendChart) {
                weeklyTrendChart = initChart('weeklyTrendChart', weeklyTrendData.labels, newDatasets, 0, 80);
            } else {
                weeklyTrendChart.data.labels = weeklyTrendData.labels;
                weeklyTrendChart.data.datasets = newDatasets;
                weeklyTrendChart.update();
            }
        }


        // ===========================================================
        // ⭐️ 2페이지: 정당 지지율 주간 로직 (새로 추가됨)
        // ===========================================================

        function parsePartyCSV(csvText, isGallup) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) {
                return {
                    labels: [],
                    partyData: {
                        '더불어민주당': [],
                        '국민의힘': [],
                        '조국혁신당': [],
                        '개혁신당': [],
                        '진보당': [],
                        '무당층': []
                    }
                };
            }
        
            // ① 헤더 행 파싱
            const headers = lines[0].split(',').map(h => h.trim());
        
            // week / 정당별 컬럼 인덱스를 헤더 이름으로 찾기
            const idxWeek   = headers.indexOf('week');
            const idxDem    = headers.indexOf('더불어민주당');
            const idxCon    = headers.indexOf('국민의힘');
            const idxCho    = headers.indexOf('조국혁신당');
            const idxReform = headers.indexOf('개혁신당');
            const idxProg   = headers.indexOf('진보당');
            const idxNone   = headers.indexOf('무당층');
        
            const labels = [];
            const data = {
                '더불어민주당': [],
                '국민의힘': [],
                '조국혁신당': [],
                '개혁신당': [],
                '진보당': [],
                '무당층': []
            };
        
            // ② 실제 데이터 행 파싱
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;    // 빈 줄 건너뛰기
        
                const values = line.split(',').map(v => v.trim());
        
                // 라벨(week)
                if (idxWeek >= 0) {
                    labels.push(values[idxWeek]);
                } else {
                    labels.push('');    // 혹시라도 week 헤더를 못 찾으면 빈 문자열
                }
        
                // 값 파싱 함수: 갤럽은 정수, 리얼미터는 소수(둘 다 parseFloat 써도 큰 문제는 없음)
                const parseVal = v => {
                    if (v === '' || v == null) return null;  // 결측은 null
                    return isGallup ? parseInt(v) : parseFloat(v);
                };
        
                if (idxDem    >= 0) data['더불어민주당'].push(parseVal(values[idxDem]));
                if (idxCon    >= 0) data['국민의힘'].push(parseVal(values[idxCon]));
                if (idxCho    >= 0) data['조국혁신당'].push(parseVal(values[idxCho]));
                if (idxReform >= 0) data['개혁신당'].push(parseVal(values[idxReform]));
                if (idxProg   >= 0) data['진보당'].push(parseVal(values[idxProg]));
                if (idxNone   >= 0) data['무당층'].push(parseVal(values[idxNone]));
            }
        
            // 디버깅용으로 첫 몇 개만 찍어서 확인해볼 수도 있어요.
            console.log("parsePartyCSV labels (first 5):", labels.slice(0, 5));
            console.log("parsePartyCSV 더불어민주당 (first 5):", data['더불어민주당'].slice(0, 5));
        
            return { labels, partyData: data };
        }

        
        // ⭐️ CSV 데이터 로드
        function loadWeeklyPartyTrendChart() {
            console.log("2페이지 데이터 로드 함수 시작.");
            const GALLUP_URL = './data/party_approval_gal_week.csv';
            const REALMETER_URL = './data/party_approval_real_week.csv';
            
            // 갤럽 데이터 로드
            const fetchGallup = fetch(GALLUP_URL)
                .then(response => response.ok ? response.text() : Promise.reject('갤럽 정당 데이터 로드 실패: ' + response.statusText))
                .then(csvText => parsePartyCSV(csvText, true));

            // 리얼미터 데이터 로드
            const fetchRealmeter = fetch(REALMETER_URL)
                .then(response => response.ok ? response.text() : Promise.reject('리얼미터 정당 데이터 로드 실패: ' + response.statusText))
                .then(csvText => parsePartyCSV(csvText, false));

            Promise.all([fetchGallup, fetchRealmeter])
                .then(([gallupResult, realmeterResult]) => {
                    weeklyPartyTrendData = {
                        gallup: gallupResult,
                        realmeter: realmeterResult
                    };
                    // 초기 차트 (갤럽) 렌더링
                    updateWeeklyPartyTrendView('gallup', document.querySelector('#party-trend-controls .btn.active'));
                })
                .catch(error => console.error("주간 정당 지지율 데이터 로드 오류:", error));
        }

        // ⭐️ 차트 뷰 업데이트
        function updateWeeklyPartyTrendView(mode, btnElement) {
            if (!weeklyPartyTrendData.gallup) return;

            document.querySelectorAll('#party-trend-controls .btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
            }

            const isGallup = mode === 'gallup';
            const source = isGallup ? weeklyPartyTrendData.gallup : weeklyPartyTrendData.realmeter;
            
            document.getElementById('party-trend-title').textContent = `주요 정당 지지율 추이 (${isGallup ? '갤럽' : '리얼미터'})`;

            const partyColors = {
                '더불어민주당': POSITIVE_COLOR,
                '국민의힘': NEGATIVE_COLOR,
                '조국혁신당': JO_GUK_COLOR,
                '개혁신당': REFORM_COLOR,
                '진보당': PROGRESSIVE_COLOR,
                '무당층': NON_PARTISAN_COLOR
            };
            
            // 정당별 데이터셋 생성 (순서 지정)
            const newDatasets = [
                { label: '더불어민주당', data: source.partyData['더불어민주당'], borderColor: partyColors['더불어민주당'], borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
                { label: '국민의힘', data: source.partyData['국민의힘'], borderColor: partyColors['국민의힘'], borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 },
                { label: '무당층', data: source.partyData['무당층'], borderColor: partyColors['무당층'], borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 6 },
                { label: '조국혁신당', data: source.partyData['조국혁신당'], borderColor: partyColors['조국혁신당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 },
                { label: '개혁신당', data: source.partyData['개혁신당'], borderColor: partyColors['개혁신당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 4 },
                { label: '진보당', data: source.partyData['진보당'], borderColor: partyColors['진보당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 5 }
            ];

            if (!weeklyPartyTrendChart) {
                // Y축 범위 0~50, DataLabels 비활성화
                weeklyPartyTrendChart = initChart('weeklyPartyTrendChart', source.labels, newDatasets, 0, 50, false); 
            } else {
                weeklyPartyTrendChart.data.labels = source.labels;
                weeklyPartyTrendChart.data.datasets = newDatasets;
                weeklyPartyTrendChart.update();
            }
        }


        // ===========================================================
        // 재사용 함수들 (initChart, 월간 데이터 등)
        // ===========================================================
        
        // [2페이지: 직무 평가 전체 데이터 - 긍정/부정]
        const pres_data_Full = [
            { label: '긍정 평가', data: [64, 58, 59, 56, 60], borderColor: POSITIVE_COLOR, backgroundColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 6, pointHoverRadius: 8, tension: 0, order: 1 },
            { label: '부정 평가', data: [23, 32, 32, 34, 30], borderColor: NEGATIVE_COLOR, backgroundColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 6, pointHoverRadius: 8, tension: 0, order: 2 }
        ];

        // [3페이지: 정당 지지율 데이터 - 7월 포함]
        const partyData_Full = [
            { label: '민주당', data: [45, 43, 40, 41, 42], borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 }, 
            { label: '국민의힘', data: [20, 23, 24, 25, 25], borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 }, 
            { label: '무당층', data: [25, 25, 27, 26, 26], borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 } 
        ];

        // 4, 5, 6페이지에 사용되는 데이터셋 (생략)
        const pres_totalData_Partial = { label: '직무 평가 전체', data: [59, 56, 60], borderColor: '#000000', backgroundColor: '#000000', borderWidth: 2, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 };
        const pres_categories_Partial = { /* ... 데이터셋 정의 유지 ... */ 
            'total': [],
            'gender': [
                { label: '남성', data: [56, 56, 60], borderColor: '#36A2EB', borderWidth: 2 },
                { label: '여성', data: [62, 56, 61], borderColor: '#FF6384', borderWidth: 2 }
            ],
            'age': [
                { label: '18~29세', data: [43, 41, 51], borderColor: '#4BC0C0', borderWidth: 2 },
                { label: '30대', data: [62, 51, 57], borderColor: '#FF9F40', borderWidth: 2 },
                { label: '40대', data: [75, 74, 76], borderColor: '#9966FF', borderWidth: 2 },
                { label: '50대', data: [71, 70, 72], borderColor: '#FFCD56', borderWidth: 2 },
                { label: '60대', data: [53, 47, 55], borderColor: '#C9CBCF', borderWidth: 2 },
                { label: '70대 이상', data: [44, 46, 47], borderColor: '#8c8c8c', borderWidth: 2, borderDash: [5, 5] }
            ],
            'region_main': [
                { label: '서울', data: [60, 50, 61], borderColor: '#E91E63', borderWidth: 3 },
                { label: '인천/경기', data: [61, 58, 60], borderColor: '#3F51B5', borderWidth: 2 },
                { label: '대구/경북', data: [41, 40, 45], borderColor: '#009688', borderWidth: 2 },
                { label: '부산/울산/경남', data: [51, 52, 56], borderColor: '#795548', borderWidth: 2 },
                { label: '광주/전라', data: [84, 80, 85], borderColor: '#4CAF50', borderWidth: 2, borderDash: [5, 5] }
            ],
            'gender_age_2030': [
                { label: '남성 20대', data: [30, 32, 45], borderColor: '#2980b9', borderWidth: 2, borderDash: [5, 2] },
                { label: '여성 20대', data: [57, 52, 58], borderColor: '#e74c3c', borderWidth: 2, borderDash: [5, 2] },
                { label: '남성 30대', data: [52, 48, 52], borderColor: '#3498db', borderWidth: 2 },
                { label: '여성 30대', data: [74, 55, 63], borderColor: '#e67e22', borderWidth: 2 }
            ]
        };
        const partyData_Partial = [
            { label: '민주당', data: [40, 41, 42], borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
            { label: '국민의힘', data: [24, 25, 25], borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 },
            { label: '무당층', data: [27, 26, 26], borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 }
        ];

        // ⭐️ 차트 초기화 함수 (DataLabels 활성화 여부 인자 추가: useLabels)
        function initChart(canvasId, labels, initialDatasets, yMin, yMax, useLabels = true) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // DataLabels 플러그인 적용 기준:
            // ⭐️ party-trend-slide를 제외하고, useLabels 인자가 true일 때만 적용
            const useDataLabels = useLabels && (
                canvasId === 'weeklyTrendChart' || 
                canvasId === 'presChartFull' || 
                canvasId === 'partyChartFull'
            );
            
            const plugins = {
                legend: { 
                    position: 'right', 
                    align: 'start', 
                    labels: { 
                        usePointStyle: true, 
                        boxWidth: 8, 
                        padding: 15 
                    } 
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const value = context.parsed.y % 1 === 0 ? context.parsed.y : context.parsed.y.toFixed(1);
                            return context.dataset.label + ': ' + value + '%';
                        }
                    }
                }
            };

            // Data Labels 플러그인 설정
            if (useDataLabels) {
                plugins.datalabels = {
                    display: true,
                    color: '#333',
                    font: { size: 11 },
                    formatter: function(value, context) { return value.toString(); },
                    align: function(context) {
                        const label = context.dataset.label;
                        
                        // 1. 직무 평가 (긍정/부정)
                        if (canvasId === 'weeklyTrendChart' || canvasId === 'presChartFull') {
                            if (label.includes('긍정')) { return 'end'; }
                            if (label.includes('부정')) { return 'start'; }
                        }
                        
                        // 2. 정당 지지율 (국민의힘만 아래쪽, 다른 주요 정당은 위쪽)
                        if (canvasId === 'partyChartFull' && label === '국민의힘') {
                            return 'start';
                        }
                        
                        return 'end';
                    },
                    offset: 5
                };
            }

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: initialDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    layout: { padding: { left: 10, right: 20, top: useDataLabels ? 25 : 10 } },
                    plugins: plugins,
                    scales: {
                        y: {
                            min: yMin, 
                            max: yMax, 
                            grid: { color: '#e0e0e0', drawBorder: false },
                            ticks: { stepSize: 10, font: { size: 11 } }
                        },
                        x: {
                            offset: true,
                            grid: { display: false },
                            ticks: { font: { size: 12 } }
                        }
                    },
                    elements: {
                        line: { tension: 0 }
                    }
                },
                plugins: useDataLabels ? [ChartDataLabels] : []
            });
        }
        
        // 4페이지: 직무 평가 차트 데이터 업데이트 (카테고리 버튼 클릭 시)
        function updatePresView(mode, btnElement) {
            // ... (기존 로직 유지) ...
            pres_controls.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            if(btnElement) {
                btnElement.classList.add('active');
                btnElement.dataset.mode = mode;
            }

            const newDatasets = [pres_totalData_Partial]; 

            if (pres_categories_Partial[mode]) {
                pres_categories_Partial[mode].forEach(ds => {
                    newDatasets.push(Object.assign({}, ds, {
                        tension: 0,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        order: 2
                    }));
                });
            }
            
            if (!presChart) {
                // 4페이지는 DataLabels 비활성 (initChart의 useDataLabels 조건으로 처리됨)
                presChart = initChart('presChart', labelsPartial, newDatasets, 20, 90, false);
            } else {
                presChart.data.datasets = newDatasets;
                presChart.update();
            }
        }

        // -----------------------------------------------------------
        // ⭐️ 슬라이드 전환 및 표시 업데이트 (전체 6페이지로 변경)
        // -----------------------------------------------------------
        function updateSlideDisplay(index) {
            document.querySelectorAll('.slide-container').forEach(slide => {
                slide.classList.add('hidden');
            });
            
            const slideId = slideOrder[index];
            document.getElementById(slideId).classList.remove('hidden');

            // 페이지 인디케이터 업데이트 (슬라이드가 6개)
            pageIndicator.textContent = `${index + 1} / ${slideOrder.length}`;

            navPrev.disabled = (index === 0);
            navNext.disabled = (index === slideOrder.length - 1);

            // 차트 렌더링
            switch(slideId) {
                case 'weekly-trend-slide': // 1페이지: 직무 주간
                    if (!weeklyTrendData.labels) loadWeeklyTrendChart();
                    else updateWeeklyTrendView(document.querySelector('#weekly-trend-controls .btn.active').dataset.mode, document.querySelector('#weekly-trend-controls .btn.active'));
                    break;
                case 'party-trend-slide': // ⭐️ 2페이지: 정당 주간 (새로 추가)
                    if (!weeklyPartyTrendData.gallup) loadWeeklyPartyTrendChart();
                    else updateWeeklyPartyTrendView(document.querySelector('#party-trend-controls .btn.active').dataset.mode, document.querySelector('#party-trend-controls .btn.active'));
                    break;
                case 'pres-slide-full': // 3페이지 (기존 2페이지): 직무 월간
                    if (!presChartFull) presChartFull = initChart('presChartFull', labelsFull, pres_data_Full, 0, 90);
                    else presChartFull.update();
                    break;
                case 'party-slide-full': // 4페이지 (기존 3페이지): 정당 월간
                    if (!partyChartFull) partyChartFull = initChart('partyChartFull', labelsFull, partyData_Full, 0, 50);
                    else partyChartFull.update();
                    break;
                case 'pres-slide': // 5페이지 (기존 4페이지): 직무 세부
                    const currentActiveBtn = pres_controls.querySelector('.btn.active');
                    updatePresView(currentActiveBtn ? currentActiveBtn.dataset.mode || 'total' : 'total', currentActiveBtn);
                    break;
                case 'party-slide': // 6페이지 (기존 5페이지): 정당 세부
                    if (!partyChart) partyChart = initChart('partyChart', labelsPartial, partyData_Partial, 0, 50, false);
                    else partyChart.update();
                    break;
            }
        }

        // ⭐️ 화살표를 통한 슬라이드 이동 함수
        function navigateSlides(direction) {
            let newIndex = currentSlideIndex + direction;

            if (newIndex >= 0 && newIndex < slideOrder.length) {
                currentSlideIndex = newIndex;
                updateSlideDisplay(currentSlideIndex);
            }
        }
        
        // 초기 로드 시 첫 번째 슬라이드 활성화
        document.addEventListener('DOMContentLoaded', () => {
            updateSlideDisplay(currentSlideIndex);
        });

    </script>
</body>
</html>
