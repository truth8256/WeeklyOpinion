<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 프레젠테이션</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        /* =========================================================
   0) VIDEO FULLSCREEN BASE
========================================================= */
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            background: #ffffff;
            overflow: hidden;
            font-family: 'Pretendard', sans-serif;
        }

        /* 중앙정렬 제거 */
        body {
            display: block;
        }

        /* =========================================================
   1) FULLSCREEN WRAPPER
========================================================= */
        .presentation-wrapper {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* 프레임 제거 */
        .slide-container {
            width: 100%;
            height: 100%;
            background: #ffffff;

            padding: 80px 120px 120px 120px;
            box-sizing: border-box;

            display: flex;
            flex-direction: column;

            position: absolute;
            inset: 0;

            opacity: 1;
            visibility: visible;
        }

        .slide-container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* =========================================================
   2) NAVIGATOR 제거 (영상용)
========================================================= */
        .slide-navigator {
            display: none;
        }

        /* =========================================================
   3) HEADER / TITLES (영상용 대형 타이포)
========================================================= */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 22px;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 14px;
        }

        .title {
            font-size: 40px;
            font-weight: 900;
            letter-spacing: -0.015em;
            color: #111;
        }

        .subtitle {
            font-size: 20px;
            color: #555;
            margin-top: 6px;
        }

        /* =========================================================
   4) CONTROLS (버튼도 키움)
========================================================= */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
        }

        .btn {
            padding: 10px 22px;
            border-radius: 24px;
            font-size: 15px;
            font-weight: 700;
            border: 1px solid #ddd;
            background: #f8fafc;
            cursor: pointer;
        }

        .btn.active {
            background: #2563eb;
            color: #fff;
            border-color: #2563eb;
        }

        /* =========================================================
   5) CHART AREA (FULL)
========================================================= */
        .chart-wrapper {
            flex: 1 1 auto;
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 0;
        }

        .chart-canvas-box {
            width: 100%;
            height: 100%;
        }

        .data-source {
            font-size: 14px;
            color: #666;
            text-align: right;
            margin-bottom: 10px;
        }

        /* =========================================================
   6) POLICY SLIDES (대형 텍스트)
========================================================= */
        .policy-slide .title-main {
            font-size: 44px;
            font-weight: 900;
            margin-bottom: 14px;
        }

        .policy-slide .title-sub {
            font-size: 22px;
            font-weight: 600;
            color: #555;
        }

        .policy-item {
            padding: 28px 32px;
            margin-bottom: 18px;
            background: #f8fbff;
            border-left: 6px solid #2563eb;
        }

        .policy-item h3 {
            font-size: 26px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .policy-item p,
        .policy-item li {
            font-size: 20px;
            line-height: 1.6;
            color: #222;
        }

        /* =========================================================
   7) RISK GRID
========================================================= */
        .risk-grid {
            display: grid;
            grid-template-columns: 3fr 1.2fr;
            gap: 28px;
            height: 100%;
        }

        .risk-card {
            padding: 24px;
            border-radius: 12px;
            text-align: center;
        }

        .risk-card h3 {
            font-size: 22px;
            margin-bottom: 6px;
        }

        .risk-big {
            font-size: 36px;
            font-weight: 800;
        }

        .risk-sub {
            font-size: 16px;
        }

        /* =========================================================
   8) YK SLIDES
========================================================= */
        .yk-mainword {
            font-size: 72px;
            font-weight: 900;
        }

        .yk-subcopy {
            font-size: 22px;
            max-width: 980px;
            line-height: 1.6;
            text-align: center;
        }

        /* =========================================================
   9) PODCAST VISUALIZATION STYLES
========================================================= */
        .insight-box {
            background-color: #eceff1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 22px;
            /* Adjusted for large screen */
            color: #37474f;
            border-left: 6px solid #1a237e;
            line-height: 1.5;
        }

        .section-badge {
            font-size: 18px;
            font-weight: 700;
            padding: 6px 14px;
            border-radius: 20px;
            color: white;
            vertical-align: middle;
            margin-right: 10px;
        }

        .badge-part2 {
            background-color: #1a237e;
        }

        .badge-part3 {
            background-color: #c62828;
        }

        /* =========================================================
   END CSS
========================================================= */
    </style>

</head>

<body>

    <div class="presentation-wrapper">

        <div class="slide-navigator">
            <button id="nav-prev" class="nav-arrow" onclick="navigateSlides(-1)" disabled>&lt;</button>
            <span id="page-indicator"></span>
            <button id="nav-next" class="nav-arrow" onclick="navigateSlides(1)">&gt;</button>
        </div>

        <div id="weekly-trend-slide" class="slide-container">
            <div class="header">
                <div id="weekly-trend-title" class="title">대통령 직무 수행 평가 추이 (갤럽)</div>
                <div class="subtitle">기간: 25년 6월 2주 ~ 26년 1월 3주 | 자료: 갤럽/리얼미터</div>
            </div>

            <div id="weekly-trend-controls" class="controls">
                <button class="btn active" data-mode="gallup"
                    onclick="updateWeeklyTrendView('gallup', this)">갤럽</button>
                <button class="btn" data-mode="realmeter"
                    onclick="updateWeeklyTrendView('realmeter', this)">리얼미터</button>
            </div>

            <div class="data-source weekly-trend-source"></div>

            <div class="chart-wrapper">
                <div class="chart-canvas-box">
                    <canvas id="weeklyTrendChart"></canvas>
                </div>
            </div>

        </div>

        <div id="party-trend-slide" class="slide-container hidden">
            <div class="header">
                <div id="party-trend-title" class="title">주요 정당 지지율 추이 (갤럽)</div>
                <div class="subtitle">기간: 25년 8월 2주 ~ 26년 1월 3주 | 자료: 갤럽/리얼미터</div>
            </div>

            <div id="party-trend-controls" class="controls">
                <button class="btn active" data-mode="gallup"
                    onclick="updateWeeklyPartyTrendView('gallup', this)">갤럽</button>
                <button class="btn" data-mode="realmeter"
                    onclick="updateWeeklyPartyTrendView('realmeter', this)">리얼미터</button>
            </div>

            <div class="data-source weekly-trend-source"></div>

            <div class="chart-wrapper">
                <div class="chart-canvas-box">
                    <canvas id="weeklyPartyTrendChart"></canvas>
                </div>
            </div>

        </div>
        <div id="pres-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 12월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div>

            <div class="chart-wrapper">
                <canvas id="presChartFull"></canvas>
            </div>
        </div>

        <div id="party-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 12월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div>

            <div class="chart-wrapper">
                <canvas id="partyChartFull"></canvas>
            </div>
        </div>

        <div id="pres-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별통합, 긍정) - 세부 비교</div>
                <div class="subtitle">기간: 2025년 9월 ~ 12월 | 자료: 한국갤럽</div>
            </div>

            <div id="pres-controls" class="controls">
                <button class="btn active" data-mode="total" onclick="updatePresView('total', this)">전체 보기</button>
                <button class="btn" data-mode="gender" onclick="updatePresView('gender', this)">성별</button>
                <button class="btn" data-mode="age" onclick="updatePresView('age', this)">연령별</button>
                <button class="btn" data-mode="region_main" onclick="updatePresView('region_main', this)">주요
                    지역별</button>
                <button class="btn" data-mode="gender_age_2030" onclick="updatePresView('gender_age_2030', this)">성/연령별
                    (2030)</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="presChart"></canvas>
            </div>

        </div>




        <!-- Part 2 Title Slide -->
        <div id="title-part2" class="slide-container hidden"
            style="justify-content: center; align-items: center; display: flex;">
            <div style="text-align: center;">
                <h1 class="title-main" style="color: #1a237e; font-size: 3rem; margin-bottom: 20px;">대통령 국정운영 지지율 60%
                </h1>
                <h2 class="title-sub" style="color: #546e7a; font-size: 2rem;">2026년에는 어떻게 될까</h2>
            </div>
        </div>

        <!-- Slide 1: Approval Trend -->
        <div id="slide-new-1" class="slide-container hidden">
            <div class="header">
                <div class="title">이재명 정부 지지율 궤적: 60%의 안정감</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew1"></canvas>
            </div>
        </div>

        <!-- Slide 2-1: Positive Evaluation Reasons -->
        <div id="slide-new-2-1" class="slide-container hidden">
            <div class="header">
                <div class="title">국정수행 긍정평가) 제일 잘 했다고 생각하는 분야</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div style="margin-bottom: 10px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
                * 국정운영 잘했다고 응답한 1,257명의 1,2순위 응답을 합산한 결과
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew2_1"></canvas>
            </div>
        </div>

        <!-- Slide 2-2: Negative Evaluation Reasons -->
        <div id="slide-new-2-2" class="slide-container hidden">
            <div class="header">
                <div class="title">국정수행 부정평가) 제일 잘 못했다고 생각하는 분야</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div style="margin-bottom: 10px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
                * 국정운영 잘못했다고 응답한 672명의 1,2순위 응답을 합산한 결과
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew2_2"></canvas>
            </div>
        </div>

        <!-- Slide 2-3: Negative Evaluation Reasons (Age) -->
        <div id="slide-new-2-3" class="slide-container hidden">
            <div class="header">
                <div class="title">국정수행 부정평가) 제일 잘 못했다고 생각하는 분야 (연령별)</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div style="margin-bottom: 10px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
                * 국정운영 잘못했다고 응답한 672명의 1,2순위 응답을 합산한 결과
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew2_3"></canvas>
            </div>
        </div>

        <!-- Slide 2-4: Reform Areas -->
        <div id="slide-new-2-4" class="slide-container hidden">
            <div class="header">
                <div class="title">집권 2년 차 우선 해결 과제</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div style="margin-bottom: 10px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
                * 질문: 다가오는 집권 2년 차(2026년)에 이재명 정부가 가장 우선적으로 해결해야 할 과제는 무엇이라고 생각하십니까?
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew2_4"></canvas>
            </div>
        </div>

        <!-- Slide 2-5: Party-Gov Relationship -->
        <div id="slide-new-2-5" class="slide-container hidden">
            <div class="header">
                <div class="title">지난 1년 당정관계 평가</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div style="margin-bottom: 10px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
                * 지난 1년 동안 여당인 더불어민주당과 대통령실 간의 국정 파트너십 평가
            </div>
            <div class="chart-wrapper">
                <div class="chart-canvas-box" style="width: 70%; margin: 0 auto;">
                    <canvas id="chartNew2_5"></canvas>
                </div>
            </div>
        </div>

        <!-- Slide 2-6: Responsibility -->
        <div id="slide-new-2-6" class="slide-container hidden">
            <div class="header">
                <div class="title">당정 협력 원활하지 않았던 책임</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>

            <div id="res-controls" class="controls">
                <button class="btn active" onclick="updateResponsibilityChart('total', this)">전체 결과</button>
                <button class="btn" onclick="updateResponsibilityChart('region', this)">지역별</button>
                <button class="btn" onclick="updateResponsibilityChart('party', this)">지지정당/성향별</button>
            </div>

            <!-- Footnote removed -->
            <div class="chart-wrapper">
                <canvas id="chartNew2_6"></canvas>
            </div>
        </div>

        <!-- Slide 2-7: Sankey Chart -->
        <div id="slide-sankey" class="slide-container hidden">
            <div class="header">
                <div class="title">대선의 선택은 어떻게 국정평가로 이어졌나</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div class="chart-wrapper" style="min-height: 600px;">
                <canvas id="chartSankey"></canvas>
            </div>
        </div>

        <!-- ⭐️ 2-8. Sankey Chart (Simplified) -->
        <div class="slide-container hidden" id="slide-sankey-simple">
            <div class="header">
                <div class="title">대선의 선택은 어떻게 국정평가로 이어졌나</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div class="chart-wrapper" style="min-height: 600px;">
                <canvas id="chartSankeySimple"></canvas>
            </div>
        </div>

        <!-- Slide 3: New Support base -->
        <div id="slide-new-3" class="slide-container hidden">
            <div class="header">
                <div class="title">지지층 해부: 누가 60%를 만드는가?</div>
                <div class="subtitle"><span class="section-badge badge-part2">PART 2</span> 국정운영 지지율</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew3"></canvas>
            </div>
        </div>


        <!-- Part 3 Title Slide -->
        <div id="title-part3" class="slide-container hidden"
            style="justify-content: center; align-items: center; display: flex;">
            <div style="text-align: center;">
                <h1 class="title-main" style="color: #c62828; font-size: 3rem; margin-bottom: 20px;">내란사건 1년 여론을 살펴본다
                </h1>
                <h2 class="title-sub" style="color: #546e7a; font-size: 2rem;">사형 구형, 2월 19일 선고</h2>
            </div>
        </div>

        <!-- Slide 4: 12.3 Event Perception -->
        <div id="slide-new-4" class="slide-container hidden">
            <div class="header">
                <div class="title">12·3 사태 인식: 국민 63% '명백한 내란'</div>
                <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
            </div>

            <div id="new4-controls" class="controls">
                <button class="btn active" onclick="updateNew4View('total', this)">전체</button>
                <button class="btn" onclick="updateNew4View('age', this)">연령별</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="chartNew4"></canvas>
            </div>
        </div>

        <!-- Slide 5: Inst Trust -->
        <div id="slide-new-5" class="slide-container hidden">
            <div class="header">
                <div class="title">기관 신뢰도: 행정부는 상승, 검찰 정체</div>
                <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew5"></canvas>
            </div>
        </div>

        <!-- Slide 6: Conspiracy Theory -->
        <div id="slide-new-6" class="slide-container hidden">
            <div class="header">
                <div class="title">부정선거 음모론</div>
                <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chartNew6"></canvas>
            </div>
        </div>


    </div>

    <!-- Slide 4-1: Investigation Evaluation (New) -->
    <div id="slide-new-4-1" class="slide-container hidden">
        <div class="header">
            <div class="title">지난 6개월간의 수사와 처벌 과정에 대한 평가</div>
            <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
        </div>
        <div style="margin-bottom: 20px; font-size: 16px; color: #555; line-height: 1.5; text-align: right;">
            * 질문: 지난 6개월간 비상계엄 관련자 수사 및 처벌, 내란죄 재판 진행 과정에 대해 어떻게 평가하십니까?
        </div>
        <div class="chart-wrapper">
            <canvas id="chartNew4_1"></canvas>
        </div>
    </div>



    <!-- Slide 4-2: Prosecutorial Reform (New) -->
    <div id="slide-new-4-2" class="slide-container hidden">
        <div class="header">
            <div class="title">검찰 개혁 핵심 쟁점 : '보완수사권' 존폐</div>
            <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
        </div>
        <div
            style="margin-bottom: 20px; font-size: 16px; color: #555; line-height: 1.5; text-align: left; background: #f5f5f5; padding: 15px; border-radius: 8px;">
            <strong>* 쟁점 설명:</strong> 경찰 송치 사건에 대한 검찰의 <b>'보완수사권'</b>을 없앨 것인가(완전 폐지), 남길 것인가(일부 존치)<br />
            ① 완전 폐지 찬성: 검찰권 남용 방지, 기소만 전담 (수사권 박탈)<br />
            ② 일부 존치 (폐지 반대): 경찰 수사 오류 시정, 중요 범죄 수사 공백 방지
        </div>

        <div id="new4-2-controls" class="controls">
            <button class="btn active" onclick="updateNew4_2View('total', this)">전체 결과</button>
            <button class="btn" onclick="updateNew4_2View('ideology', this)">정치 성향별</button>
            <button class="btn" onclick="updateNew4_2View('party', this)">지지 정당별</button>
        </div>

        <div class="chart-wrapper">
            <canvas id="chartNew4_2"></canvas>
        </div>

    </div>

    <!-- Slide 6: Election Trust (Revamped) -->
    <div id="slide-new-6" class="slide-container hidden">
        <div class="header">
            <div class="title">믿음의 양극화: 부정선거 음모론</div>
            <div class="subtitle"><span class="section-badge badge-part3">PART 3</span> 내란사건 1년 여론</div>
        </div>

        <div id="new6-controls" class="controls" style="flex-wrap: wrap; justify-content: center; gap: 8px;">
            <!-- Buttons will be injected by JS -->
        </div>

        <div class="chart-wrapper" style="height: 300px; margin-top: 30px;">
            <canvas id="chartNew6"></canvas>
        </div>
        <div style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
            * 1: 전혀 동의 안 함 ~ 4: 매우 동의함
        </div>
    </div>

    <script>
        /* =========================================================
            VIDEO CHART PRESET
        ========================================================= */
        Chart.defaults.font.family = 'Pretendard, sans-serif';
        Chart.defaults.font.size = 16;
        Chart.defaults.plugins.legend.labels.font = { size: 16, weight: '600' };
        Chart.defaults.plugins.tooltip.bodyFont = { size: 16 };
        Chart.defaults.plugins.tooltip.titleFont = { size: 16 };

        // -----------------------------------------------------------
        // ⭐️ 전역 설정 및 상수 (색상 통일 적용)
        // -----------------------------------------------------------

        // Chart.js 전역 폰트 설정 (한글 깨짐 방지 및 폰트 통일)
        Chart.defaults.font.family = 'Pretendard, sans-serif';
        Chart.defaults.font.size = 18;

        // ⭐️ 사용할 색상 정의 (정치 데이터 vs 자립청년 데이터)
        const POSITIVE_COLOR = '#0056b3'; // 민주당, 직무 긍정 (일반 데이터: 푸른색)
        const NEGATIVE_COLOR = '#C9151E'; // 국민의힘, 직무 부정 (취약 데이터: 붉은색)
        const JO_GUK_COLOR = '#4B0082';
        const REFORM_COLOR = '#F38400';
        const PROGRESSIVE_COLOR = '#008000';
        const NON_PARTISAN_COLOR = '#666666'; // 무당층

        // DataLabels 플러그인 등록
        Chart.register(ChartDataLabels);

        // 정치 데이터 라벨
        const labelsFull = ['7월', '8월', '9월', '10월', '11월'];
        const labelsPartial = ['9월', '10월', '11월'];

        // 함께 공표·보도하여야 할 사항
        const SOURCE_WEEKLY_GALLUP = `
        * 1월 3주 조사 : 한국갤럽 자체조사로 26년 1월 13일~15일, 무선100% 전화면접(CATI)로 진행함. 그 밖의 사항은 중앙선거여론조사심의위원회 홈페이지 참조`;
        const SOURCE_WEEKLY_REALMETER = `
        * 1월 3주 조사 : 에너지경제신문의뢰로 리얼미터가 26년 1월 12일~16일, 무선100% ARS로 진행함. 그 밖의 사항은 중앙선거여론조사심의위원회 홈페이지 참조`;

        // --- 차트 데이터 및 객체 ---
        // 정치 데이터 차트 객체 (기존 유지)
        let presChartFull = null;
        let partyChartFull = null;
        let presChart = null;
        let partyChart = null;
        let weeklyTrendChart = null;
        let weeklyTrendData = {};
        let weeklyPartyTrendChart = null;
        let weeklyPartyTrendData = {};

        // 자립청년 데이터 차트 객체 (새로 추가) -> 팟캐스트 시각화 차트 객체
        let chartNew1 = null;
        let chartNew2_1 = null;
        let chartNew2_2 = null;
        let chartNew2_3 = null;
        let chartNew3 = null;
        let chartNew4 = null;
        let chartNew5 = null;
        let chartNew6 = null;

        // ⭐️ CSV 데이터 저장소 (새로 추가)
        let monthlyMainData = null;      // monthly_main_trends.csv
        let monthlyDetailedData = null;  // monthly_pres_detailed.csv

        // ⭐️ 슬라이드 순서 및 상태 관리
        const slideOrder = [
            'title-part2', 'slide-new-1', 'slide-new-2-1', 'slide-new-2-2', 'slide-new-2-3',
            'slide-new-2-4', 'slide-new-2-5', 'slide-new-2-6', 'slide-sankey', 'slide-sankey-simple', 'slide-new-3',  // [6~16] 2부

            'title-part3', 'slide-new-4', 'slide-new-4-1', 'slide-new-4-2', 'slide-new-5', 'slide-new-6',   // [17~22] 3부 (4-2 추가)
            'weekly-trend-slide', 'party-trend-slide', 'pres-slide-full', 'party-slide-full', 'pres-slide' // [1~5] 정치 데이터
        ];
        let currentSlideIndex = 0;
        const pageIndicator = document.getElementById('page-indicator');
        const navPrev = document.getElementById('nav-prev');
        const navNext = document.getElementById('nav-next');
        const pres_controls = document.getElementById('pres-controls');

        // 책임 소재 데이터 (전역)
        const responsibilityData = {
            labels: ['전체', '서울', '경기/인천', '대전/충청', '광주/전라', '대구/경북', '부울경', '민주당 지지', '국힘 지지', '조국혁신당', '진보', '중도', '보수'],
            data: {
                // 당의 의견을 충분히 수용하지 않은 대통령실(정부)
                gov: [10.8, 8.1, 12.0, 9.4, 12.0, 16.5, 7.2, 4.9, 16.7, 14.1, 3.1, 8.6, 16.3],
                // 정부를 적극적으로 뒷받침하지 못한 민주당 지도부
                party: [38.2, 42.6, 41.5, 36.1, 42.5, 22.5, 39.7, 67.4, 20.9, 66.2, 71.5, 39.0, 24.0],
                // 양측 모두 비슷
                both: [47.1, 47.8, 42.3, 50.9, 34.3, 53.5, 50.2, 23.2, 59.5, 12.5, 21.3, 47.9, 56.4]
            }
        };


        // ... (기존 load/update 함수들)

        // ===========================================================
        // ⭐️ 추가된 차트 함수들 (2-4 ~ 2-6)
        // ===========================================================

        function createChartNew2_4() {
            const ctx = document.getElementById('chartNew2_4').getContext('2d');
            const data = {
                labels: [
                    ['민생 경제 회복', '(물가 안정, 금리 부담 완화)'],
                    ['내란 극복', '(12·3 비상계엄 관련자 처벌 및 진상규명)'],
                    ['국민 통합 및 협치', '(정치 양극화 해소)'],
                    ['부동산 시장 안정', '(집값 관리, 전세 사기 대책)'],
                    ['외교/안보 강화', '(미·중·일 관계 관리)'],
                    '저출생/고령화 대책 마련',
                    '기타',
                    '잘 모르겠다'
                ],
                datasets: [{
                    label: '응답 비율 (%)',
                    data: [46.7, 16.3, 14.3, 8.6, 6.0, 5.2, 2.0, 1.0],
                    backgroundColor: [
                        '#1a237e', // 1st
                        '#283593',
                        '#303f9f',
                        '#3949ab',
                        '#3f51b5',
                        '#5c6bc0',
                        '#78909c',
                        '#90a4ae'
                    ],
                    barPercentage: 0.7,
                    categoryPercentage: 0.8
                }]
            };
            return new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    layout: { padding: { left: 10, right: 80, top: 20, bottom: 20 } },
                    scales: {
                        x: { beginAtZero: true, max: 55, ticks: { font: { size: 14 } }, grid: { display: false } },
                        y: { ticks: { font: { size: 15, weight: 'bold' }, autoSkip: false } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#333',
                            anchor: 'end',
                            align: 'end',
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                }
            });
        }

        function createChartNew2_5() {
            const ctx = document.getElementById('chartNew2_5').getContext('2d');

            // 데이터 구성
            // Inner: 긍정(49.6), 부정(38.3), 모름(12.1)
            // Outer: 매우원활(7.0), 대체로원활(42.6), 별로원활X(26.1), 전혀원활X(12.2), 모름(12.1)

            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        '매우 원활', '대체로 원활',  // 긍정 그룹
                        '별로 원활X', '전혀 원활X',  // 부정 그룹
                        '모름'
                    ],
                    datasets: [
                        // Outer Ring: 통합 (Aggregated) - Index 0
                        {
                            label: '통합 평가',
                            data: [49.6, 38.3, 12.1], // 긍정, 부정, 모름
                            backgroundColor: [
                                '#1a237e', // 긍정 (파랑)
                                '#c62828', // 부정 (빨강)
                                '#90a4ae'  // 모름 (진한 회색)
                            ],
                            weight: 1.0
                        },
                        // Inner Ring: 상세 (Detailed) - Index 1
                        {
                            label: '상세 평가',
                            data: [7.0, 42.6, 26.1, 12.2, 12.1],
                            backgroundColor: [
                                '#0d47a1', // 매우 원활 (짙은 파랑)
                                '#42a5f5', // 대체로 원활 (밝은 파랑)
                                '#ef5350', // 별로 원활X (밝은 빨강)
                                '#b71c1c', // 전혀 원활X (짙은 빨강)
                                '#cfd8dc'  // 모름 (회색)
                            ],
                            weight: 1.0
                        }
                    ]
                },
                options: {
                    ...podCommonOptions,
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: {
                            position: 'right',
                            labels: {
                                generateLabels: function (chart) {
                                    const legends = [
                                        { text: '매우 원활 (7.0%)', fillStyle: '#0d47a1' },
                                        { text: '대체로 원활 (42.6%)', fillStyle: '#42a5f5' },
                                        { text: '별로 원활하지 못함 (26.1%)', fillStyle: '#ef5350' },
                                        { text: '전혀 원활하지 못함 (12.2%)', fillStyle: '#b71c1c' },
                                        { text: '잘 모름 (12.1%)', fillStyle: '#cfd8dc' }
                                    ];
                                    return legends.map(l => ({
                                        text: l.text,
                                        fillStyle: l.fillStyle,
                                        strokeStyle: l.fillStyle,
                                        hidden: false,
                                        lineCap: 'butt',
                                        lineDash: [],
                                        lineDashOffset: 0,
                                        lineJoin: 'miter',
                                        lineWidth: 0,
                                        datasetIndex: 1 // Inner set refer (Detailed)
                                    }));
                                },
                                font: { size: 16, weight: '600' },
                                padding: 20
                            }
                        },
                        datalabels: {
                            display: true,
                            textAlign: 'right',
                            color: '#fff',
                            font: function (context) {
                                // Outer(0)는 크게, Inner(1)는 작게
                                const dsIndex = context.datasetIndex;
                                return dsIndex === 0 ? { size: 20, weight: 'bold' } : { size: 16, weight: '600' };
                            },
                            formatter: (v, ctx) => {
                                const dsIndex = ctx.datasetIndex;
                                const dataIndex = ctx.dataIndex;

                                if (dsIndex === 0) {
                                    // Outer Ring: 통합 수치 + 라벨
                                    const label = ['원활함 ', '원활하지  \n못함  ', '모름 '][dataIndex];
                                    return label + '\n' + v.toFixed(1) + '%';
                                } else {
                                    // Inner Ring: 상세 수치만
                                    return v > 5 ? v.toFixed(1) + '%' : '';
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const dsIndex = context.datasetIndex;
                                    const dataIndex = context.dataIndex;
                                    const value = context.parsed;

                                    if (dsIndex === 1) {
                                        // Inner
                                        const labels = ['매우 원활', '대체로 원활', '별로 원활X', '전혀 원활X', '모름'];
                                        return `${labels[dataIndex]}: ${value}%`;
                                    } else {
                                        // Outer
                                        const labels = ['긍정 합계', '부정 합계', '모름'];
                                        return `${labels[dataIndex]}: ${value}%`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        let chartNew2_6 = null; // 전역 변수로 관리

        function updateResponsibilityChart(mode, btn) {
            if (btn) {
                document.querySelectorAll('#res-controls .btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            const ctx = document.getElementById('chartNew2_6').getContext('2d');
            let labels, dataGov, dataParty, dataBoth;

            if (mode === 'total') {
                labels = ['전체'];
                dataGov = [responsibilityData.data.gov[0]];
                dataParty = [responsibilityData.data.party[0]];
                dataBoth = [responsibilityData.data.both[0]];
            } else if (mode === 'region') {
                labels = responsibilityData.labels.slice(1, 7); // 서울 ~ 부울경
                dataGov = responsibilityData.data.gov.slice(1, 7);
                dataParty = responsibilityData.data.party.slice(1, 7);
                dataBoth = responsibilityData.data.both.slice(1, 7);
            } else if (mode === 'party') {
                labels = responsibilityData.labels.slice(7); // 민주 ~ 보수 (지지정당/성향 등)
                dataGov = responsibilityData.data.gov.slice(7);
                dataParty = responsibilityData.data.party.slice(7);
                dataBoth = responsibilityData.data.both.slice(7);
            }

            const newData = {
                labels: labels,
                datasets: [
                    {
                        label: '민주당 지도부 책임',
                        data: dataParty,
                        backgroundColor: '#1a237e', // 파랑 (민주당 색)
                        barPercentage: 0.6
                    },
                    {
                        label: '대통령실(정부) 책임',
                        data: dataGov,
                        backgroundColor: '#c62828', // 빨강 (반대 느낌?)
                        barPercentage: 0.6
                    },
                    {
                        label: '양측 비슷',
                        data: dataBoth,
                        backgroundColor: '#78909c', // 회색
                        barPercentage: 0.6
                    }
                ]
            };

            if (chartNew2_6) {
                chartNew2_6.data = newData;
                chartNew2_6.update();
            } else {
                chartNew2_6 = new Chart(ctx, {
                    type: 'bar',
                    data: newData,
                    options: {
                        ...podCommonOptions,
                        indexAxis: 'y', // 세로형 리스트 느낌
                        scales: {
                            x: { stacked: true, max: 100, grid: { display: false } }, // 100% 기준
                            y: { stacked: true, ticks: { font: { size: 16, weight: 'bold' } } }
                        },
                        plugins: {
                            ...podCommonOptions.plugins,
                            legend: {
                                position: 'right',
                                align: 'start',
                                labels: {
                                    usePointStyle: true,
                                    boxWidth: 8,
                                    padding: 15,
                                    font: { size: 16, weight: '600' }
                                }
                            },
                            datalabels: {
                                display: true,
                                color: '#fff',
                                font: { size: 14 },
                                formatter: (v) => v > 5 ? v.toFixed(1) : '' // 5% 미만은 숨김
                            }
                        }
                    }
                });
            }
        }

        // ... (existing updateResponsibilityChart)

        // ===========================================================
        // ⭐️ Sankey Chart Logic (Slide 2-7)
        // ===========================================================
        let sankeyData = null;
        let chartSankey = null;

        function loadSankeyData() {
            // CSV: id, 1st, 2nd, 3rd, wt
            const DATA_URL = './data/sankey.csv';

            fetch(DATA_URL)
                .then(res => res.ok ? res.text() : Promise.reject('Sankey Load Failed'))
                .then(text => {
                    const lines = text.trim().split('\n').slice(1); // skip header
                    const flows = {};
                    // Key: "SourceNode_TargetNode" -> Value: Sum of weights

                    lines.forEach(line => {
                        const cols = line.split(',');
                        if (cols.length < 5) return;

                        let source = parseInt(cols[1].trim()); // 1st
                        let target = parseInt(cols[3].trim()); // 3rd
                        let weight = parseFloat(cols[4].trim());

                        // 1) Merge Wave 1 categories (4, 5, 6 -> 4)
                        if (source === 4 || source === 5 || source === 6) {
                            source = 4;
                        }

                        // 2) Map to keys
                        // Source: Q1_1 (Lee), Q1_2 (Kim), Q1_3 (LeeJS), Q1_4 (Others)
                        // Target: Q3_1 (VeryBad), Q3_2 (Bad), Q3_3 (Good), Q3_4 (VeryGood), Q3_9 (Unknown)
                        const sourceKey = `Q1_${source}`;
                        const targetKey = `Q3_${target}`;

                        const flowKey = `${sourceKey}|${targetKey}`;
                        if (!flows[flowKey]) flows[flowKey] = 0;
                        flows[flowKey] += weight;
                    });

                    // Prepare Chart.js data
                    const flowData = [];
                    for (const [key, value] of Object.entries(flows)) {
                        const [from, to] = key.split('|');
                        flowData.push({ from, to, flow: value });
                    }

                    sankeyData = flowData;
                    if (document.getElementById('slide-sankey').classList.contains('hidden') === false) {
                        createSankeyChart();
                    }
                })
                .catch(err => console.error(err));
        }

        function createSankeyChart() {
            if (!sankeyData) {
                loadSankeyData();
                return;
            }

            const ctx = document.getElementById('chartSankey').getContext('2d');

            const existingChart = Chart.getChart('chartSankey');
            if (existingChart) existingChart.destroy();

            // Define colors
            const colors = {
                'Q1_1': '#1a237e', // Lee (Blue)
                'Q1_2': '#c62828', // Kim (Red)
                'Q1_3': '#ff9800', // LeeJS (Orange)
                'Q1_4': '#9e9e9e', // Others (Grey)

                'Q3_1': '#b71c1c', // Very Bad (Deep Red) - Left side of right
                'Q3_2': '#ef5350', // Bad (Light Red)
                'Q3_9': '#cfd8dc', // Unknown (Grey) - Middle
                'Q3_3': '#42a5f5', // Good (Light Blue)
                'Q3_4': '#0d47a1'  // Very Good (Deep Blue)
            };

            const labels = {
                'Q1_1': '이재명', 'Q1_2': '김문수', 'Q1_3': '이준석', 'Q1_4': '기타/무응답',
                'Q3_1': '매우 잘못함', 'Q3_2': '잘못하는 편', 'Q3_3': '잘하는 편', 'Q3_4': '매우 잘함', 'Q3_9': '잘 모름'
            };

            // Custom ordering for layout:
            // Left: Lee(1), Kim(2), LeeJS(3), Others(4)
            // Right Priority: VeryBad(1) -> Bad(2) -> Unknown(9) -> Good(3) -> VeryGood(4)
            const priority = {
                'Q1_1': 1, 'Q1_2': 2, 'Q1_3': 3, 'Q1_4': 4,
                'Q3_1': 1, 'Q3_2': 2, 'Q3_9': 3, 'Q3_3': 4, 'Q3_4': 5
            };

            chartSankey = new Chart(ctx, {
                type: 'sankey',
                data: {
                    datasets: [{
                        data: sankeyData,
                        colorFrom: (c) => colors[c.raw.from] || '#cccccc',
                        colorTo: (c) => colors[c.raw.to] || '#cccccc',
                        colorMode: 'gradient', // or 'from', 'to'
                        labels: labels,
                        priority: priority,
                        nodeWidth: 50, // 1차/3차 시점 강조를 위해 막대 두께 증가
                        // column processing is automatic usually, but we can hints
                        size: 'max', // adjust node size
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 20 },
                    plugins: {
                        datalabels: { display: false }, // Force disable datalabels
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const item = ctx.raw;
                                    return `${labels[item.from]} → ${labels[item.to]}: ${item.flow.toFixed(0)}`;
                                }
                            }
                        }
                    }
                }
            });
            return chartSankey;
        }

        // ===========================================================
        // ⭐️ Sankey Chart Simple Logic (Slide 2-8)
        // ===========================================================
        let sankeySimpleData = null;
        let chartSankeySimple = null;

        function loadSankeySimpleData() {
            console.log("Starting loadSankeySimpleData...");
            const DATA_URL = './data/sankey.csv';

            fetch(DATA_URL)
                .then(res => res.ok ? res.text() : Promise.reject('Sankey Simple Load Failed'))
                .then(text => {
                    const lines = text.trim().split('\n').slice(1);
                    const flows = {};

                    lines.forEach(line => {
                        const cols = line.split(',');
                        if (cols.length < 5) return;

                        let source = parseInt(cols[1].trim()); // 1st
                        let target = parseInt(cols[3].trim()); // 3rd
                        let weight = parseFloat(cols[4].trim());

                        // 1) Simplify Source (Lee vs Non-Lee)
                        // 1=Lee, 2~6=Non-Lee
                        let sourceLabel = (source === 1) ? 'Lee' : 'NonLee';

                        // 2) Simplify Target (Pos vs Neg vs Unknown)
                        // 1,2 -> Negative
                        // 3,4 -> Positive
                        // 9   -> Unknown
                        let targetLabel;
                        if (target === 1 || target === 2) targetLabel = 'Negative';
                        else if (target === 3 || target === 4) targetLabel = 'Positive';
                        else targetLabel = 'Unknown';

                        const flowKey = `${sourceLabel}|${targetLabel}`;
                        if (!flows[flowKey]) flows[flowKey] = 0;
                        flows[flowKey] += weight;
                    });

                    const flowData = [];
                    for (const [key, value] of Object.entries(flows)) {
                        const [from, to] = key.split('|');
                        flowData.push({ from, to, flow: value });
                    }

                    sankeySimpleData = flowData;

                    const container = document.getElementById('slide-sankey-simple');
                    if (container && !container.classList.contains('hidden')) {
                        createSankeySimpleChart();
                    }
                })
                .catch(err => console.error(err));
        }

        function createSankeySimpleChart() {
            if (!sankeySimpleData) {
                loadSankeySimpleData();
                return;
            }

            const ctx = document.getElementById('chartSankeySimple').getContext('2d');

            const existingChart = Chart.getChart('chartSankeySimple');
            if (existingChart) existingChart.destroy();

            // Colors
            // Lee: Blue (#1a237e), NonLee: Grey (#9e9e9e)
            // Positive: Blue (#1a237e), Negative: Red (#c62828), Unknown: Grey (#cfd8dc)
            const colors = {
                'Lee': '#1a237e',
                'NonLee': '#9e9e9e',
                'Positive': '#1a237e', // Same as Lee for flow continuity visual
                'Negative': '#c62828',
                'Unknown': '#cfd8dc'
            };

            const labels = {
                'Lee': '이재명 지지',
                'NonLee': '이재명 지지 안함',
                'Positive': '국정운영 긍정',
                'Negative': '국정운영 부정',
                'Unknown': '잘 모름'
            };

            const priority = {
                'Lee': 1, 'NonLee': 2,
                'Negative': 1, 'Unknown': 2, 'Positive': 3
            };

            chartSankeySimple = new Chart(ctx, {
                type: 'sankey',
                data: {
                    datasets: [{
                        data: sankeySimpleData,
                        colorFrom: (c) => colors[c.raw.from] || '#cccccc',
                        colorTo: (c) => colors[c.raw.to] || '#cccccc',
                        colorMode: 'gradient',
                        labels: labels,
                        priority: priority,
                        nodeWidth: 50, // 1차/3차 시점 강조를 위해 막대 두께 증가
                        size: 'max'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 40 },
                    plugins: {
                        datalabels: { display: false },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const item = ctx.raw;
                                    return `${labels[item.from]} → ${labels[item.to]}: ${item.flow.toFixed(0)}`;
                                }
                            }
                        }
                    }
                }
            });
            return chartSankeySimple;
        }


        // ===========================================================
        // ⭐️ 1-6 페이지 (정치 데이터) 관련 함수 (기존 코드 유지)
        // ===========================================================

        function parseCombinedCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const labels = [];
            const gallupData = { good: [], bad: [] };
            const realmeterData = { good: [], bad: [] };

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    labels.push(values[0].trim());
                    realmeterData.good.push(parseFloat(values[1].trim()));
                    realmeterData.bad.push(parseFloat(values[2].trim()));
                    gallupData.good.push(parseInt(values[4].trim()));
                    gallupData.bad.push(parseInt(values[5].trim()));
                }
            }
            return { labels, gallupData, realmeterData };
        }

        function loadWeeklyTrendChart() {
            const DATA_URL = './data/presidential_approval_real_gal.csv';

            fetch(DATA_URL)
                .then(response => response.ok ? response.text() : Promise.reject('주간 직무 데이터 로드 실패: ' + response.statusText))
                .then(csvText => {
                    weeklyTrendData = parseCombinedCSV(csvText);
                    updateWeeklyTrendView('gallup', document.querySelector('#weekly-trend-controls .btn.active'));
                })
                .catch(error => console.error("주간 직무 데이터 로드 오류:", error));
        }

        function updateWeeklySource(mode) {
            const isGallup = (mode === 'gallup');
            const html = isGallup ? SOURCE_WEEKLY_GALLUP : SOURCE_WEEKLY_REALMETER;

            // 현재 문서에 있는 동일 출처 영역을 모두 갱신 (1쪽/2쪽 동시에 해결)
            document.querySelectorAll('.weekly-trend-source').forEach(el => {
                el.innerHTML = html;
            });
        }

        function updateWeeklyTrendView(mode, btnElement) {
            if (!weeklyTrendData.labels) return;

            document.querySelectorAll('#weekly-trend-controls .btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
            }

            const isGallup = mode === 'gallup';
            currentWeeklyTrendMode = mode;   // ⭐️ 현재 1페이지 모드 저장
            updateWeeklySource(mode);
            const source = isGallup ? weeklyTrendData.gallupData : weeklyTrendData.realmeterData;

            document.getElementById('weekly-trend-title').textContent = `대통령 직무 수행 평가 추이 (${isGallup ? '갤럽' : '리얼미터'})`;

            const newDatasets = [
                { label: '긍정', data: source.good, borderColor: POSITIVE_COLOR, backgroundColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
                { label: '부정', data: source.bad, borderColor: NEGATIVE_COLOR, backgroundColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 }
            ];

            if (!weeklyTrendChart) {
                weeklyTrendChart = initChart('weeklyTrendChart', weeklyTrendData.labels, newDatasets, 0, 80);
            } else {
                weeklyTrendChart.data.labels = weeklyTrendData.labels;
                weeklyTrendChart.data.datasets = newDatasets;
                weeklyTrendChart.update();
            }
        }

        // ===========================================================
        // ⭐️ 2페이지: 정당 지지율 주간 로직 (새로 추가됨)
        // ===========================================================

        function parsePartyCSV(csvText, isGallup) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) {
                return {
                    labels: [],
                    partyData: {
                        '더불어민주당': [],
                        '국민의힘': [],
                        '조국혁신당': [],
                        '개혁신당': [],
                        '진보당': [],
                        '무당층': []
                    }
                };
            }

            // ① 헤더 행 파싱
            const headers = lines[0].split(',').map(h => h.trim());

            // week / 정당별 컬럼 인덱스를 헤더 이름으로 찾기
            const idxWeek = headers.indexOf('week');
            const idxDem = headers.indexOf('더불어민주당');
            const idxCon = headers.indexOf('국민의힘');
            const idxCho = headers.indexOf('조국혁신당');
            const idxReform = headers.indexOf('개혁신당');
            const idxProg = headers.indexOf('진보당');
            const idxNone = headers.indexOf('무당층');

            const labels = [];
            const data = {
                '더불어민주당': [],
                '국민의힘': [],
                '조국혁신당': [],
                '개혁신당': [],
                '진보당': [],
                '무당층': []
            };

            // ② 실제 데이터 행 파싱
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;    // 빈 줄 건너뛰기

                const values = line.split(',').map(v => v.trim());

                // 라벨(week)
                if (idxWeek >= 0) {
                    labels.push(values[idxWeek]);
                } else {
                    labels.push('');    // 혹시라도 week 헤더를 못 찾으면 빈 문자열
                }

                // 값 파싱 함수: 갤럽은 정수, 리얼미터는 소수(둘 다 parseFloat 써도 큰 문제는 없음)
                const parseVal = v => {
                    if (v === '' || v == null) return null;  // 결측은 null
                    return isGallup ? parseInt(v) : parseFloat(v);
                };

                if (idxDem >= 0) data['더불어민주당'].push(parseVal(values[idxDem]));
                if (idxCon >= 0) data['국민의힘'].push(parseVal(values[idxCon]));
                if (idxCho >= 0) data['조국혁신당'].push(parseVal(values[idxCho]));
                if (idxReform >= 0) data['개혁신당'].push(parseVal(values[idxReform]));
                if (idxProg >= 0) data['진보당'].push(parseVal(values[idxProg]));
                if (idxNone >= 0) data['무당층'].push(parseVal(values[idxNone]));
            }

            // 디버깅용으로 첫 몇 개만 찍어서 확인해볼 수도 있어요.
            console.log("parsePartyCSV labels (first 5):", labels.slice(0, 5));
            console.log("parsePartyCSV 더불어민주당 (first 5):", data['더불어민주당'].slice(0, 5));

            return { labels, partyData: data };
        }


        // ⭐️ CSV 데이터 로드
        function loadWeeklyPartyTrendChart() {
            console.log("2페이지 데이터 로드 함수 시작.");
            const GALLUP_URL = './data/party_approval_gal_week.csv';
            const REALMETER_URL = './data/party_approval_real_week.csv';

            // 갤럽 데이터 로드
            const fetchGallup = fetch(GALLUP_URL)
                .then(response => response.ok ? response.text() : Promise.reject('갤럽 정당 데이터 로드 실패: ' + response.statusText))
                .then(csvText => parsePartyCSV(csvText, true));

            // 리얼미터 데이터 로드
            const fetchRealmeter = fetch(REALMETER_URL)
                .then(response => response.ok ? response.text() : Promise.reject('리얼미터 정당 데이터 로드 실패: ' + response.statusText))
                .then(csvText => parsePartyCSV(csvText, false));

            Promise.all([fetchGallup, fetchRealmeter])
                .then(([gallupResult, realmeterResult]) => {
                    weeklyPartyTrendData = {
                        gallup: gallupResult,
                        realmeter: realmeterResult
                    };
                    // 초기 차트 (갤럽) 렌더링
                    updateWeeklyPartyTrendView('gallup', document.querySelector('#party-trend-controls .btn.active'));
                })
                .catch(error => console.error("주간 정당 지지율 데이터 로드 오류:", error));
        }

        // ⭐️ 차트 뷰 업데이트
        function updateWeeklyPartyTrendView(mode, btnElement) {
            if (!weeklyPartyTrendData.gallup) return;

            document.querySelectorAll('#party-trend-controls .btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
            }

            const isGallup = mode === 'gallup';
            currentWeeklyPartyMode = mode;   // ⭐️ 현재 모드를 전역에 저장
            updateWeeklySource(mode);
            const source = isGallup ? weeklyPartyTrendData.gallup : weeklyPartyTrendData.realmeter;

            document.getElementById('party-trend-title').textContent = `주요 정당 지지율 추이 (${isGallup ? '갤럽' : '리얼미터'})`;

            const partyColors = {
                '더불어민주당': POSITIVE_COLOR,
                '국민의힘': NEGATIVE_COLOR,
                '조국혁신당': JO_GUK_COLOR,
                '개혁신당': REFORM_COLOR,
                '진보당': PROGRESSIVE_COLOR,
                '무당층': NON_PARTISAN_COLOR
            };

            // 정당별 데이터셋 생성 (순서 지정)
            const newDatasets = [
                { label: '더불어민주당', data: source.partyData['더불어민주당'], borderColor: partyColors['더불어민주당'], borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
                { label: '국민의힘', data: source.partyData['국민의힘'], borderColor: partyColors['국민의힘'], borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 },
                { label: '무당층', data: source.partyData['무당층'], borderColor: partyColors['무당층'], borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 6 },
                { label: '조국혁신당', data: source.partyData['조국혁신당'], borderColor: partyColors['조국혁신당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 },
                { label: '개혁신당', data: source.partyData['개혁신당'], borderColor: partyColors['개혁신당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 4 },
                { label: '진보당', data: source.partyData['진보당'], borderColor: partyColors['진보당'], borderWidth: 2, pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 5 }
            ];

            if (!weeklyPartyTrendChart) {
                // ✅ useLabels=true (또는 생략) 로 변경
                weeklyPartyTrendChart = initChart('weeklyPartyTrendChart', source.labels, newDatasets, 0, 50, true);
            } else {
                weeklyPartyTrendChart.data.labels = source.labels;
                weeklyPartyTrendChart.data.datasets = newDatasets;
                weeklyPartyTrendChart.update();
            }
        }


        // ===========================================================
        // 재사용 함수들 (initChart, 월간 데이터 등)
        // ===========================================================

        // ===========================================================
        // ⭐️ CSV 파싱 및 로드 (월간 데이터) - 새로 추가
        // ===========================================================

        function parseMonthlyMainCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const labels = [];

            // 데이터 구조 초기화
            const data = {
                pres_good: [], pres_bad: [],
                party_dem: [], party_con: [], party_none: []
            };

            for (let i = 1; i < lines.length; i++) {
                const row = lines[i].split(',');
                if (row.length < headers.length) continue;

                // 빈 값(예: 12월 데이터 없음)이면 넣지 않음 or null 처리
                // 여기서는 "값이 없으면 null" -> Chart.js가 건너뜀
                const val = (v) => (v && v.trim() !== '') ? Number(v) : null;

                labels.push(row[0]);
                data.pres_good.push(val(row[1]));
                data.pres_bad.push(val(row[2]));
                data.party_dem.push(val(row[3]));
                data.party_con.push(val(row[4]));
                data.party_none.push(val(row[5]));
            }
            return { labels, data };
        }

        function parseMonthlyDetailedCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const labels = [];

            // 동적으로 키-값 배열 매핑
            const data = {};
            // headers[1]부터 끝까지 키 생성
            for (let k = 1; k < headers.length; k++) {
                data[headers[k].trim()] = [];
            }

            for (let i = 1; i < lines.length; i++) {
                const row = lines[i].split(',');
                if (row.length < headers.length) continue;

                labels.push(row[0]);
                for (let k = 1; k < headers.length; k++) {
                    const key = headers[k].trim();
                    const v = row[k];
                    data[key].push((v && v.trim() !== '') ? Number(v) : null);
                }
            }
            return { labels, data };
        }

        function loadMonthlyMainData() {
            return fetch('./data/monthly_main_trends.csv')
                .then(res => res.ok ? res.text() : Promise.reject(res.statusText))
                .then(text => {
                    monthlyMainData = parseMonthlyMainCSV(text);
                })
                .catch(err => console.error('월간 메인 데이터 로드 실패:', err));
        }

        function loadMonthlyDetailedData() {
            return fetch('./data/monthly_pres_detailed.csv')
                .then(res => res.ok ? res.text() : Promise.reject(res.statusText))
                .then(text => {
                    monthlyDetailedData = parseMonthlyDetailedCSV(text);
                })
                .catch(err => console.error('월간 상세 데이터 로드 실패:', err));
        }

        // -----------------------------------------------------------
        // ⭐️ 팟캐스트 시각화 관련 함수 (새로 추가)
        // -----------------------------------------------------------

        // 공통 옵션
        const podCommonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { font: { family: "'Pretendard', sans-serif", size: 16, weight: '600' } } },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: 10,
                    titleFont: { size: 16 },
                    bodyFont: { size: 16 }
                },
                datalabels: {
                    display: true,
                    color: '#333',
                    font: { size: 16, weight: 'bold' },
                    anchor: 'end',
                    align: 'top',
                    offset: 4,
                    formatter: (v) => v.toFixed(1)
                }
            }
        };

        function createChartNew1() {
            const ctx = document.getElementById('chartNew1').getContext('2d');
            const data = {
                labels: [['1차 조사 (25.5)', '대선후보 지지도'], ['2차 조사 (25.9)', '국정운영 긍정평가'], ['3차 조사 (25.12)', '국정운영 긍정평가']],
                datasets: [{
                    label: '지지율(%)',
                    data: [49.3, 62.7, 62.2],
                    borderColor: '#1a237e',
                    backgroundColor: '#1a237e',
                    pointRadius: 6,
                    borderWidth: 3,
                    tension: 0
                }]
            };
            return new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    ...podCommonOptions,
                    scales: {
                        x: { offset: true, ticks: { font: { size: 16 } }, grid: { display: false } },
                        y: { beginAtZero: false, min: 40, max: 70, ticks: { font: { size: 16 } } }
                    },
                    layout: { padding: { left: 10, right: 20, top: 25 } },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#333',
                            font: { size: 16, weight: 'bold' },
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                }
            });
        }

        function createChartNew2_1() {
            const ctx = document.getElementById('chartNew2_1').getContext('2d');
            const data = {
                labels: ['외교/안보', '경제/조세 정책', '내란 극복', '복지/노동', '정치/소통', '기타', '잘 모르겠다'],
                datasets: [
                    {
                        label: '긍정 평가 이유 (%)',
                        data: [81.6, 34.6, 31.3, 30.4, 14.2, 1.1, 3.4],
                        backgroundColor: '#1a237e',
                        barPercentage: 0.7,
                        categoryPercentage: 0.8
                    }
                ]
            };
            return new Chart(ctx, {
                type: 'bar', // Horizontal bar will be set by indexAxis: 'y'
                data: data,
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    layout: { padding: { left: 50, right: 100, top: 20, bottom: 20 } }, // 여백 추가하여 차트 너비 줄임
                    scales: {
                        x: { beginAtZero: true, max: 100, ticks: { font: { size: 14 } }, grid: { display: false } }, // x축 그리드 제거
                        y: { ticks: { font: { size: 16, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#333',
                            anchor: 'end',
                            align: 'end', // 바 오른쪽 바깥
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                }
            });
        }

        function createChartNew2_2() {
            const ctx = document.getElementById('chartNew2_2').getContext('2d');
            const data = {
                labels: ['경제/민생', '협치 부족/독주', '부동산 정책', '인사', '외교/안보', '기타', '잘 모르겠다'],
                datasets: [
                    {
                        label: '부정 평가 이유 (%)',
                        data: [53.7, 47.8, 34.8, 28.1, 27.7, 4.3, 1.9],
                        backgroundColor: '#c62828',
                        barPercentage: 0.7,
                        categoryPercentage: 0.8
                    }
                ]
            };
            return new Chart(ctx, {
                type: 'bar', // Horizontal bar will be set by indexAxis: 'y'
                data: data,
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    layout: { padding: { left: 50, right: 100, top: 20, bottom: 20 } }, // 여백 추가하여 차트 너비 줄임
                    scales: {
                        x: { beginAtZero: true, max: 100, ticks: { font: { size: 14 } }, grid: { display: false } },
                        y: { ticks: { font: { size: 16, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#333',
                            anchor: 'end',
                            align: 'end', // 바 오른쪽 바깥
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                }
            });
        }

        function createChartNew2_3() {
            const ctx = document.getElementById('chartNew2_3').getContext('2d');
            const data = {
                labels: ['18~29세', '30~39세', '40~49세', '50~59세', '60~69세', '70세 이상'],
                datasets: [
                    {
                        label: '경제/민생',
                        data: [76.6, 66.3, 56.7, 53.6, 40.3, 34.5],
                        borderColor: '#c62828', // Red
                        backgroundColor: '#c62828',
                        pointRadius: 5,
                        borderWidth: 3,
                        tension: 0
                    },
                    {
                        label: '협치 부족/독주',
                        data: [23.3, 33.1, 38.8, 50.3, 58.1, 74.1],
                        borderColor: '#1a237e', // Cold (Navy)
                        backgroundColor: '#1a237e',
                        pointRadius: 5,
                        borderWidth: 3,
                        tension: 0
                    },
                    {
                        label: '부동산 정책',
                        data: [41.0, 43.9, 34.6, 33.7, 32.1, 25.4],
                        borderColor: '#4db6ac', // Desaturated Teal
                        backgroundColor: '#4db6ac',
                        pointRadius: 5,
                        borderWidth: 3,
                        tension: 0
                    },
                    {
                        label: '인사',
                        data: [14.4, 25.5, 29.4, 27.2, 31.4, 39.7],
                        borderColor: '#78909c', // Grey
                        backgroundColor: '#78909c',
                        pointRadius: 5,
                        borderWidth: 3,
                        tension: 0
                    },
                    {
                        label: '외교/안보',
                        data: [39.0, 23.8, 29.4, 19.7, 28.2, 23.4],
                        borderColor: '#9575cd', // Desaturated Purple
                        backgroundColor: '#9575cd',
                        pointRadius: 5,
                        borderWidth: 3,
                        tension: 0
                    }
                ]
            };
            return new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    ...podCommonOptions,
                    layout: { padding: { left: 10, right: 20, top: 25 } },
                    scales: {
                        x: { offset: true, ticks: { font: { size: 16 } }, grid: { display: false } },
                        y: { beginAtZero: true, max: 100, ticks: { font: { size: 16 } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        datalabels: {
                            display: 'auto',
                            align: 'top',
                            anchor: 'end',
                            font: { size: 14, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        },
                        legend: {
                            position: 'right',
                            align: 'start',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                padding: 15,
                                font: { size: 14, weight: '600' }
                            }
                        }
                    }
                }
            });
        }

        function createChartNew3() {
            const ctx = document.getElementById('chartNew3').getContext('2d');
            const data = {
                labels: ['Old 이재명 (기존 지지층)', 'New 이재명 (신규 유입층)'],
                datasets: [{
                    data: [78.1, 21.9],
                    backgroundColor: ['#1a237e', '#fbc02d'],
                    hoverOffset: 4
                }]
            };
            return new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    ...podCommonOptions,
                    plugins: {
                        ...podCommonOptions.plugins,
                        title: { display: true, text: '국정 지지층(긍정 평가자) 구성', font: { size: 18 } },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                }
            });
        }

        function updateNew4View(mode, btn) {
            if (btn) {
                document.querySelectorAll('#new4-controls .btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            const ctx = document.getElementById('chartNew4').getContext('2d');
            const labelsTotal = ['명백한 내란 행위', '절차 문제 있는 정치적 사건', '불가피한 구국의 결단', '모름'];
            // Total Data (Previous: 63.1, 18.9, 14.9, 3.2) - Reordering for Stack logic if needed, but horizontal bar is fine.
            // Let's use simple Horizontal Bar for total to show ranking clearly.

            // Views:
            // 1. Total: Horizontal Bar (Sorted?) -> User table order: 内亂, Process, Salvation, Unknown.

            // 2. Age: Stacked Bar 100%
            // Rows: 18~29, 30~39, 40~49, 50~59, 60~69, 70+

            let chartType = 'bar';
            let chartData = {};
            let chartOptions = {};

            if (mode === 'total') {
                chartData = {
                    labels: ['명백한 내란 행위', ['절차 문제 있는', '정치적 사건'], '불가피한 구국의 결단', '모름'],
                    datasets: [{
                        label: '응답 비율 (%)',
                        data: [63.1, 18.9, 14.9, 3.2],
                        backgroundColor: [
                            '#1a237e', // 명백한 내란 (Blue - DP/Progressive view)
                            '#78909c', // 절차 문제 (Grey - Middle)
                            '#c62828', // 구국 결단 (Red - Conservative/Yoon view)
                            '#eceff1'  // 모름
                        ]
                    }]
                };

                chartOptions = {
                    ...podCommonOptions,
                    indexAxis: 'y', // Horizontal
                    scales: {
                        x: { beginAtZero: true, max: 80, ticks: { font: { size: 14 } }, grid: { display: false } }, // 그리드 제거
                        y: { ticks: { font: { size: 16, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: (ctx) => ctx.dataIndex === 3 ? '#333' : '#fff',
                            anchor: 'end',
                            align: (ctx) => ctx.dataIndex === 3 ? 'end' : 'start', // 모름은 바깥, 나머지는 안쪽
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1) + '%'
                        }
                    }
                };
            } else {
                // Age Breakdown (Stacked)
                const ageLabels = ['18~29세', '30~39세', '40~49세', '50~59세', '60~69세', '70세 이상'];
                chartData = {
                    labels: ageLabels,
                    datasets: [
                        {
                            label: '명백한 내란 행위',
                            data: [55.6, 67.3, 74.8, 76.7, 54.3, 46.1],
                            backgroundColor: '#1a237e'
                        },
                        {
                            label: '절차 문제/정치적 사건',
                            data: [20.5, 17.6, 14.8, 12.9, 21.5, 27.3],
                            backgroundColor: '#78909c'
                        },
                        {
                            label: '구국의 결단',
                            data: [17.4, 12.9, 7.8, 7.7, 21.0, 24.3],
                            backgroundColor: '#c62828'
                        },
                        {
                            label: '모름/무응답',
                            data: [6.4, 2.1, 2.6, 2.7, 3.2, 2.3],
                            backgroundColor: '#eceff1'
                        }
                    ]
                };

                chartOptions = {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    scales: {
                        x: { stacked: true, max: 100, ticks: { font: { size: 14 } }, grid: { display: false } },
                        y: { stacked: true, ticks: { font: { size: 16, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: {
                            position: 'bottom',
                            labels: { usePointStyle: true, boxWidth: 10, padding: 15, font: { size: 14 } }
                        },
                        datalabels: {
                            display: true,
                            color: (ctx) => ctx.datasetIndex === 3 ? '#333' : '#fff', // 마지막(모름)만 어둡게
                            font: { size: 14 },
                            formatter: (v) => v > 5 ? v.toFixed(1) : '' // 5% 이하는 숨김
                        }
                    }
                };
            }

            if (chartNew4) {
                chartNew4.destroy(); // Type change requires destroy usually
            }

            chartNew4 = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: chartOptions
            });
        }

        // Init proxy function for first load
        function createChartNew4() {
            updateNew4View('total', null);
            return chartNew4;
        }

        let chartNew4_1 = null;

        function createChartNew4_1() {
            const ctx = document.getElementById('chartNew4_1').getContext('2d');
            const data = {
                labels: [
                    ['여전히 진상규명이 미흡하고', '처벌이 약하다'],
                    ['정치적 보복 성격이 강하며', '과도하게 진행되고 있다'],
                    ['법과 원칙에 따라 철저하게', '진상규명과 처벌이 이루어지고 있다'],
                    '잘 모르겠다'
                ],
                datasets: [{
                    label: '응답 비율 (%)',
                    data: [44.7, 33.3, 17.2, 4.8],
                    backgroundColor: [
                        '#1a237e', // 미흡하다 (진보/강경 - Blue)
                        '#c62828', // 과도하다/정치보복 (보수 - Red)
                        '#43a047', // 철저하다/원칙대로 (긍정/중립 - Green)
                        '#eceff1'  // 모름
                    ],
                    barPercentage: 0.6,
                    categoryPercentage: 0.8
                }]
            };

            return new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    layout: { padding: { left: 10, right: 80, top: 20, bottom: 20 } },
                    scales: {
                        x: { beginAtZero: true, max: 60, ticks: { font: { size: 14 } }, grid: { display: false } },
                        y: { ticks: { font: { size: 16, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#333',
                            anchor: 'end',
                            align: 'end',
                            font: { size: 16, weight: 'bold' },
                            formatter: (v) => v.toFixed(1) + '%'
                        }
                    }
                }
            });
        }

        let chartNew4_2 = null;

        function updateNew4_2View(mode, btn) {
            if (btn) {
                document.querySelectorAll('#new4-2-controls .btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }

            const ctx = document.getElementById('chartNew4_2').getContext('2d');

            // Data Definition
            // Option 1: Abolition (Blue)
            // Option 2: Retention (Red)
            // Option 3: Unknown (Grey)
            const COLOR_ABOLITION = '#1a237e'; // Blue
            const COLOR_RETENTION = '#c62828'; // Red
            const COLOR_UNKNOWN = '#eceff1';   // Grey

            let labels = [];
            let data1 = []; // Abolition
            let data2 = []; // Retention
            let data3 = []; // Unknown

            let isStacked = false;
            let indexAxis = 'y'; // Default Horizontal

            if (mode === 'total') {
                // Total View: Simple Horizontal Bar comparing the 3 options
                labels = [['완전 폐지 찬성', '(수사권 박탈)'], ['일부 존치', '(폐지 반대)'], '잘 모르겠다'];
                // Data: 38.3, 50.9, 10.8
                // We format this as a single dataset bar chart for simple comparison

                const dataTotal = {
                    labels: labels,
                    datasets: [{
                        label: '응답 비율',
                        data: [38.3, 50.9, 10.8],
                        backgroundColor: [COLOR_ABOLITION, COLOR_RETENTION, COLOR_UNKNOWN],
                        barPercentage: 0.6
                    }]
                };

                if (chartNew4_2) chartNew4_2.destroy();

                chartNew4_2 = new Chart(ctx, {
                    type: 'bar',
                    data: dataTotal,
                    options: {
                        ...podCommonOptions,
                        indexAxis: 'y',
                        scales: {
                            x: { beginAtZero: true, max: 60, grid: { display: false } },
                            y: { ticks: { font: { size: 16, weight: 'bold' } } }
                        },
                        plugins: {
                            ...podCommonOptions.plugins,
                            legend: { display: false },
                            datalabels: {
                                display: true,
                                color: (ctx) => ctx.dataIndex === 2 ? '#333' : '#fff', // 3rd is grey bg
                                anchor: 'end',
                                align: (ctx) => ctx.dataIndex === 2 ? 'end' : 'start',
                                formatter: (v) => v.toFixed(1) + '%'
                            }
                        }
                    }
                });
                return;

            } else if (mode === 'ideology') {
                labels = ['진보', '중도', '보수'];
                // 1: Abolition, 2: Retention, 3: Unknown
                data1 = [66.9, 35.1, 15.5];
                data2 = [26.1, 50.1, 76.7];
                data3 = [7.0, 14.9, 7.8];
                isStacked = true;

            } else if (mode === 'party') {
                labels = ['더불어민주당', '조국혁신당', '진보당', '개혁신당', '국민의힘', '그 외 정당', '무당층', '잘모름'];
                // Order: DP, Cho, Prog, Reform, PPP, Others, None, Unknown (Grouped by similarity roughly)
                // DP
                data1.push(62.9); data2.push(27.9); data3.push(9.2);
                // Cho
                data1.push(67.1); data2.push(24.8); data3.push(8.1);
                // Prog
                data1.push(48.7); data2.push(51.3); data3.push(0.0);
                // Reform
                data1.push(11.1); data2.push(86.4); data3.push(2.5);
                // PPP
                data1.push(7.4); data2.push(83.1); data3.push(9.4);
                // Others
                data1.push(30.5); data2.push(63.9); data3.push(5.6);
                // None
                data1.push(11.5); data2.push(63.6); data3.push(24.9);
                // Unknown
                data1.push(8.4); data2.push(45.1); data3.push(46.5);

                isStacked = true;
            }

            // Stacked Chart Construction
            const dataStacked = {
                labels: labels,
                datasets: [
                    {
                        label: '완전 폐지 찬성',
                        data: data1,
                        backgroundColor: COLOR_ABOLITION
                    },
                    {
                        label: '일부 존치 (폐지 반대)',
                        data: data2,
                        backgroundColor: COLOR_RETENTION
                    },
                    {
                        label: '잘 모르겠다',
                        data: data3,
                        backgroundColor: COLOR_UNKNOWN
                    }
                ]
            };

            if (chartNew4_2) chartNew4_2.destroy();

            chartNew4_2 = new Chart(ctx, {
                type: 'bar',
                data: dataStacked,
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    scales: {
                        x: { stacked: true, max: 100, grid: { display: false } }, // 100%
                        y: { stacked: true, ticks: { font: { size: 15, weight: 'bold' } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: {
                            position: 'bottom',
                            labels: { usePointStyle: true, padding: 20, font: { size: 14 } }
                        },
                        datalabels: {
                            display: true,
                            color: (ctx) => ctx.datasetIndex === 2 ? '#333' : '#fff', // Last index (unknown) is dark text
                            formatter: (v) => v > 5 ? v.toFixed(1) : '' // Hide small values
                        }
                    }
                }
            });
        }

        // Init Proxy
        function createChartNew4_2() {
            updateNew4_2View('total', null);
            return chartNew4_2;
        }

        function createChartNew5() {
            const ctx = document.getElementById('chartNew5').getContext('2d');
            const data = {
                labels: ['1차 조사(25.2)', '2차 조사(25.9)', '3차 조사(25.12)'],
                datasets: [
                    {
                        label: '헌재',
                        data: [5.2, 5.2, 5.2],
                        borderColor: '#8e24aa', // 보라색
                        backgroundColor: '#8e24aa',
                        borderWidth: 3,
                        pointRadius: 6,
                        tension: 0
                    },
                    {
                        label: '중앙선관위',
                        data: [4.7, 5.0, 5.1],
                        borderColor: '#0288d1', // 하늘색
                        backgroundColor: '#0288d1',
                        borderWidth: 3,
                        pointRadius: 6,
                        tension: 0
                    },
                    {
                        label: '행정부',
                        data: [4.2, 4.8, 5.0],
                        borderColor: '#1a237e', // 짙은 파랑
                        backgroundColor: '#1a237e',
                        borderWidth: 3,
                        pointRadius: 6,
                        tension: 0
                    },
                    {
                        label: '국회',
                        data: [3.8, 4.1, 4.1],
                        borderColor: '#43a047', // 초록
                        backgroundColor: '#43a047',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        pointRadius: 6,
                        tension: 0
                    },
                    {
                        label: '법원',
                        data: [3.8, 4.0, 3.9],
                        borderColor: '#ffa726', // 주황
                        backgroundColor: '#ffa726',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        pointRadius: 6,
                        tension: 0
                    },
                    {
                        label: '검찰',
                        data: [3.2, 3.2, 3.3],
                        borderColor: '#78909c', // 회색
                        backgroundColor: '#78909c',
                        borderWidth: 3,
                        borderDash: [2, 2],
                        pointRadius: 6,
                        tension: 0
                    }
                ]
            };
            return new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    ...podCommonOptions,
                    layout: { padding: { left: 10, right: 20, top: 25 } },
                    scales: {
                        x: { offset: true, ticks: { font: { size: 16 } }, grid: { display: false } },
                        y: { min: 2, max: 6, title: { display: true, text: '신뢰도 (10점 만점)' }, ticks: { font: { size: 16 } } }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: {
                            position: 'right',
                            align: 'start',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                padding: 15,
                                font: { size: 16, weight: '600' }
                            }
                        },
                        datalabels: {
                            display: true,
                            align: 'top',
                            anchor: 'end',
                            font: { size: 14, weight: 'bold' },
                            formatter: (v) => v.toFixed(1),
                            // 데이터 많으므로 겹침 방지 위해 일부 조정이 필요할 수 있으나 일단 기본값
                            display: 'auto'
                        }
                    }
                }
            });
        }

        // ===========================================================
        // ⭐️ Slide 6 Logic (New Dot Plot)
        // ===========================================================
        let electionTrustData = [];
        // chartNew6 is global

        function loadElectionTrustData() {
            console.log("Loading Election Trust Data...");
            const DATA_URL = './data/election_trust_survey.csv';
            fetch(DATA_URL)
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    return res.text();
                })
                .then(text => {
                    const lines = text.trim().split('\n').slice(1); // Skip header
                    if (lines.length === 0) throw new Error("CSV appears empty");

                    electionTrustData = lines.map(line => {
                        const cols = line.split(',');
                        if (cols.length < 3) return null;
                        return {
                            question: cols[0],
                            total: parseFloat(cols[1]),
                            ppp: parseFloat(cols[2])
                        };
                    }).filter(item => item !== null);

                    console.log("Election Data Loaded:", electionTrustData);

                    // Clear controls if any exists (we don't need buttons anymore)
                    const container = document.getElementById('new6-controls');
                    if (container) container.innerHTML = '';

                    // Render the specific bar chart
                    const slide6 = document.getElementById('slide-new-6');
                    if (slide6 && !slide6.classList.contains('hidden')) {
                        renderConspiracyBarChart();
                    }
                })
                .catch(err => console.error("Slide 6 Load Error:", err));
        }

        function renderConspiracyBarChart() {
            if (!electionTrustData || electionTrustData.length === 0) return;

            const targets = [
                '사전투표는 조작 가능성이 높다',
                '선거관리위원회는 선거를 공정하게 관리한다',
                '중국이 선거에 개입할 가능성이 높다'
            ];

            const filteredData = electionTrustData.filter(item => targets.includes(item.question));
            // Sort by header order
            filteredData.sort((a, b) => targets.indexOf(a.question) - targets.indexOf(b.question));

            const ctx = document.getElementById('chartNew6').getContext('2d');
            const questions = filteredData.map(d => d.question);
            const totalScores = filteredData.map(d => d.total);
            const pppScores = filteredData.map(d => d.ppp);

            if (chartNew6) chartNew6.destroy();

            chartNew6 = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: questions,
                    datasets: [
                        {
                            label: '전체',
                            data: totalScores,
                            backgroundColor: '#78909c',
                            borderColor: '#78909c',
                            borderWidth: 1,
                            barPercentage: 0.9,
                            categoryPercentage: 0.6
                        },
                        {
                            label: '국민의힘 지지층',
                            data: pppScores,
                            backgroundColor: '#c62828',
                            borderColor: '#c62828',
                            borderWidth: 1,
                            barPercentage: 0.9,
                            categoryPercentage: 0.6
                        }
                    ]
                },
                options: {
                    ...podCommonOptions,
                    indexAxis: 'y',
                    layout: { padding: { top: 20, bottom: 20, left: 10, right: 30 } },
                    scales: {
                        x: {
                            min: 1, max: 4,
                            ticks: {
                                font: { size: 16, weight: 'bold' },
                                color: '#000',
                                stepSize: 1,
                                callback: function (value) {
                                    const map = { 1: '전혀 동의안함', 2: '별로 동의안함', 3: '대체로 동의', 4: '매우 동의' };
                                    return map[value] || value;
                                }
                            },
                            grid: { drawBorder: false, color: '#eee' }
                        },
                        y: {
                            ticks: { font: { size: 16, weight: 'bold' } }
                        }
                    },
                    plugins: {
                        ...podCommonOptions.plugins,
                        legend: {
                            display: true,
                            position: 'right',
                            labels: { usePointStyle: true, font: { size: 14 } }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            color: '#333',
                            font: { size: 14, weight: 'bold' },
                            formatter: (v) => v.toFixed(1)
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // createChartNew6 function removed, handled in switch directly to check data loading state

        // ⭐️ 차트 초기화 함수 (DataLabels 활성화 여부 인자 추가: useLabels)
        function initChart(canvasId, labels, initialDatasets, yMin, yMax, useLabels = true) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            // ✅ DataLabels 적용 대상에 weeklyPartyTrendChart 추가
            const useDataLabels = useLabels && (
                canvasId === 'weeklyTrendChart' ||
                canvasId === 'presChartFull' ||
                canvasId === 'partyChartFull' ||
                canvasId === 'weeklyPartyTrendChart' ||
                canvasId === 'presChart'    // ✅ 세부 비교 차트도 라벨 표시
            );

            const plugins = {
                legend: {
                    position: 'right',
                    align: 'start',
                    labels: {
                        usePointStyle: true,
                        boxWidth: 8,
                        padding: 15
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            let value = context.parsed.y;

                            // ✅ 1페이지: 직무 주간 차트
                            if (canvasId === 'weeklyTrendChart') {
                                if (currentWeeklyTrendMode === 'realmeter') {
                                    // 리얼미터: 항상 소수 1자리
                                    value = value.toFixed(1);
                                } else {
                                    // 갤럽: 정수면 정수, 아니면 소수 1자리
                                    value = Number.isInteger(value) ? value.toString() : value.toFixed(1);
                                }
                            }
                            // ✅ 2페이지: 정당 주간 차트
                            else if (canvasId === 'weeklyPartyTrendChart') {
                                if (currentWeeklyPartyMode === 'realmeter') {
                                    value = value.toFixed(1);
                                } else {
                                    value = Number.isInteger(value) ? value.toString() : value.toFixed(1);
                                }
                            }
                            // ✅ 그 외 차트들
                            else {
                                value = Number.isInteger(value) ? value.toString() : value.toFixed(1);
                            }

                            return context.dataset.label + ': ' + value + '%';
                        }
                    }
                }
            };

            if (useDataLabels) {
                plugins.datalabels = {
                    display: function (context) {
                        const label = context.dataset.label;

                        // 1페이지: 직무 주간 (긍정/부정만)
                        if (canvasId === 'weeklyTrendChart') {
                            return label === '긍정' || label === '부정';
                        }

                        // 3페이지: 직무 월간 (긍정 평가/부정 평가만)
                        if (canvasId === 'presChartFull') {
                            return label === '긍정 평가' || label === '부정 평가';
                        }

                        // 3페이지: 정당 월간 (민주당/국민의힘/무당층만)
                        if (canvasId === 'partyChartFull') {
                            // ⭐ 여기서 '민주당' 과 '더불어민주당' 둘 다 인정
                            return ['민주당', '더불어민주당', '국민의힘', '무당층'].includes(label);
                        }

                        // 2페이지: 정당 주간 (더불어민주당/국민의힘/무당층만)
                        if (canvasId === 'weeklyPartyTrendChart') {
                            return ['더불어민주당', '국민의힘', '무당층'].includes(label);
                        }

                        // presChart(세부 비교): 'auto'로 겹침 자동 숨김 -> 겹쳐도 보이게 true
                        if (canvasId === 'presChart') {
                            return true;
                        }

                        // 그 외 (partyChart 등)
                        return false;
                    },
                    color: '#333',
                    font: { size: 16 },
                    // 이하 formatter / align / offset 그대로 유지
                    formatter: function (value, context) {
                        // 1페이지: 직무 주간
                        if (canvasId === 'weeklyTrendChart') {
                            if (currentWeeklyTrendMode === 'realmeter') {
                                return value.toFixed(1);
                            } else {
                                return Number.isInteger(value) ? value.toString() : value.toFixed(1);
                            }
                        }
                        // 2페이지: 정당 주간
                        if (canvasId === 'weeklyPartyTrendChart') {
                            if (currentWeeklyPartyMode === 'realmeter') {
                                return value.toFixed(1);
                            } else {
                                return Number.isInteger(value) ? value.toString() : value.toFixed(1);
                            }
                        }
                        // 나머지 차트들
                        return Number.isInteger(value) ? value.toString() : value.toFixed(1);
                    },
                    align: function (context) {
                        const label = context.dataset.label;

                        // 1페이지(직무 주간): 긍정 위, 부정 아래
                        if (canvasId === 'weeklyTrendChart') {
                            if (label === '긍정') return 'end';
                            if (label === '부정') return 'start';
                        }

                        // 3페이지(직무 월간): 긍정 평가 위, 부정 평가 아래
                        if (canvasId === 'presChartFull') {
                            if (label.includes('긍정')) return 'end';
                            if (label.includes('부정')) return 'start';
                        }

                        // 3페이지 정당 월간 + 2페이지 정당 주간
                        // 국민의힘 아래, 민주당/더불어민주당/무당층 위
                        if (canvasId === 'partyChartFull' || canvasId === 'weeklyPartyTrendChart') {
                            if (label === '국민의힘') return 'start'; // 아래
                            if (label === '민주당' || label === '더불어민주당' || label === '무당층') {
                                return 'end';                        // 위
                            }
                        }

                        // presChart: 라인 끝(end) 또는 위(start) 등 -> 'auto' display와 함께 'end' 추천
                        if (canvasId === 'presChart') {
                            return 'end';
                        }

                        return 'end';
                    },


                    offset: 5
                };
            }

            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: initialDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    layout: { padding: { left: 10, right: 20, top: useDataLabels ? 25 : 10 } },
                    plugins: plugins,
                    scales: {
                        y: {
                            min: yMin,
                            max: yMax,
                            grid: { color: '#e0e0e0', drawBorder: false },
                            ticks: { stepSize: 10, font: { size: 16 } }
                        },
                        x: {
                            offset: true,
                            grid: { display: false },
                            ticks: { font: { size: 16 } }
                        }
                    },
                    elements: {
                        line: { tension: 0 }
                    }
                },
                plugins: useDataLabels ? [ChartDataLabels] : []
            });
        }


        // 4페이지(세부) 업데이트 로직 수정
        function updatePresView(mode, btnElement) {
            pres_controls.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
                btnElement.dataset.mode = mode;
            }

            // 1) CSV 로드가 안됐으면 리턴
            if (!monthlyDetailedData) return;

            // 2) 최근 4개월 데이터만 사용 (slice(-4)) - 9월부터 나오게 하기 위함
            //    단, 12월 데이터가 비어있을 수 있으므로 "값이 있는 마지막 4개"를 찾거나,
            //    단순히 마지막 4개를 가져오되 null은 표시 안됨.
            const totalLen = monthlyDetailedData.labels.length;
            const startIndex = Math.max(0, totalLen - 4);

            // 3) Partial 차트용 데이터셋 구성 함수
            const sliceData = (arrKey) => {
                const arr = monthlyDetailedData.data[arrKey];
                return arr ? arr.slice(startIndex) : [];
            };

            // 기본: 전체(total)
            const baseData = sliceData('total');
            const newDatasets = [
                { label: '직무 평가 전체', data: baseData, borderColor: '#000000', backgroundColor: '#000000', borderWidth: 2, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 }
            ];

            // 추가: 선택된 모드에 따른 데이터셋
            //     CSV 헤더명과 모드명이 일치해야 함 (gender -> gender_m, gender_f 등)
            if (mode === 'gender') {
                newDatasets.push({ label: '남성', data: sliceData('gender_m'), borderColor: '#36A2EB', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '여성', data: sliceData('gender_f'), borderColor: '#FF6384', borderWidth: 2, tension: 0 });
            }
            else if (mode === 'age') {
                newDatasets.push({ label: '18~29세', data: sliceData('age_1829'), borderColor: '#4BC0C0', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '30대', data: sliceData('age_30s'), borderColor: '#FF9F40', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '40대', data: sliceData('age_40s'), borderColor: '#9966FF', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '50대', data: sliceData('age_50s'), borderColor: '#FFCD56', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '60대', data: sliceData('age_60s'), borderColor: '#C9CBCF', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '70대 이상', data: sliceData('age_70over'), borderColor: '#8c8c8c', borderWidth: 2, borderDash: [5, 5], tension: 0 });
            }
            else if (mode === 'region_main') {
                newDatasets.push({ label: '서울', data: sliceData('seoul'), borderColor: '#E91E63', borderWidth: 3, tension: 0 });
                newDatasets.push({ label: '인천/경기', data: sliceData('incheon_gyeonggi'), borderColor: '#3F51B5', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '대구/경북', data: sliceData('daegu_gyeongbuk'), borderColor: '#009688', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '부산/울산/경남', data: sliceData('busan_ulsan_gyeongnam'), borderColor: '#795548', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '광주/전라', data: sliceData('gwangju_jeolla'), borderColor: '#4CAF50', borderWidth: 2, borderDash: [5, 5], tension: 0 });
            }
            else if (mode === 'gender_age_2030') {
                newDatasets.push({ label: '남성 20대', data: sliceData('m_20s'), borderColor: '#2980b9', borderWidth: 2, borderDash: [5, 2], tension: 0 });
                newDatasets.push({ label: '여성 20대', data: sliceData('f_20s'), borderColor: '#e74c3c', borderWidth: 2, borderDash: [5, 2], tension: 0 });
                newDatasets.push({ label: '남성 30대', data: sliceData('m_30s'), borderColor: '#3498db', borderWidth: 2, tension: 0 });
                newDatasets.push({ label: '여성 30대', data: sliceData('f_30s'), borderColor: '#e67e22', borderWidth: 2, tension: 0 });
            }

            // 라벨도 잘라줌
            const partialLabels = monthlyDetailedData.labels.slice(startIndex);

            if (!presChart) {
                // presChart만 생성 (레이블 on) - 겹침 방지 설정 추가됨
                presChart = initChart('presChart', partialLabels, newDatasets, 20, 90, true);
            } else {
                presChart.data.labels = partialLabels;
                presChart.data.datasets = newDatasets;
                presChart.update();
            }
        }


        // -----------------------------------------------------------
        // ⭐️ 슬라이드 전환 및 표시 업데이트 (전체 6페이지로 변경)
        // -----------------------------------------------------------
        function updateSlideDisplay(index) {
            // 1) 인덱스 가드
            if (index < 0 || index >= slideOrder.length) return;

            // 2) 전체 숨김
            document.querySelectorAll('.slide-container').forEach(slide => {
                slide.classList.add('hidden');
            });

            // 3) 현재 슬라이드 표시 (ID 존재 여부 체크)
            const slideId = slideOrder[index];
            const slideEl = document.getElementById(slideId);

            if (!slideEl) {
                console.error(`[updateSlideDisplay] 슬라이드 ID를 찾을 수 없습니다: ${slideId}`);
                // 최소한 네비 UI는 업데이트하고 종료
                pageIndicator.textContent = `${index + 1} / ${slideOrder.length}`;
                navPrev.disabled = (index === 0);
                navNext.disabled = (index === slideOrder.length - 1);
                return;
            }

            slideEl.classList.remove('hidden');

            // 4) 네비 UI 업데이트 (하드코딩 제거)
            pageIndicator.textContent = `${index + 1} / ${slideOrder.length}`;
            navPrev.disabled = (index === 0);
            navNext.disabled = (index === slideOrder.length - 1);

            // 5) 차트/렌더링: 필요한 슬라이드에서만 실행
            switch (slideId) {
                case 'slide-new-2-4':
                    if (!document.getElementById('chartNew2_4').$chart) {
                        // Chart property marker
                        const c = createChartNew2_4();
                        document.getElementById('chartNew2_4').$chart = c;
                    }
                    break;
                case 'slide-new-2-5':
                    if (!document.getElementById('chartNew2_5').$chart) {
                        const c = createChartNew2_5();
                        document.getElementById('chartNew2_5').$chart = c;
                    }
                    break;
                case 'slide-new-2-6':
                    // 초기값 total로 생성
                    if (!chartNew2_6) {
                        updateResponsibilityChart('total', document.querySelector('#res-controls .btn.active'));
                    }
                    break;
                case 'slide-sankey':
                    if (!sankeyData) {
                        loadSankeyData();
                    }
                    else if (document.getElementById('slide-sankey').classList.contains('hidden') === false && !chartSankey) {
                        createSankeyChart();
                    }
                    break;

                case 'slide-sankey-simple':
                    if (!sankeySimpleData) {
                        loadSankeySimpleData();
                    }
                    else if (document.getElementById('slide-sankey-simple').classList.contains('hidden') === false && !chartSankeySimple) {
                        createSankeySimpleChart();
                    }
                    break;
                case 'weekly-trend-slide': // 1페이지: 직무 주간
                    if (!weeklyTrendData.labels) loadWeeklyTrendChart();
                    else updateWeeklyTrendView(
                        document.querySelector('#weekly-trend-controls .btn.active')?.dataset.mode,
                        document.querySelector('#weekly-trend-controls .btn.active')
                    );
                    break;

                case 'party-trend-slide': // 2페이지: 정당 주간
                    if (!weeklyPartyTrendData.gallup) loadWeeklyPartyTrendChart();
                    else updateWeeklyPartyTrendView(
                        document.querySelector('#party-trend-controls .btn.active')?.dataset.mode,
                        document.querySelector('#party-trend-controls .btn.active')
                    );
                    break;

                case 'pres-slide-full': // 3페이지: 직무 월간 (CSV 사용)
                    if (!monthlyMainData) {
                        loadMonthlyMainData().then(() => {
                            // 로드 후 재귀 호출 또는 직접 그리기
                            // 여기서는 간단히 다시 그리기 로직 수행
                            const d = monthlyMainData.data;
                            const ds = [
                                { label: '긍정 평가', data: d.pres_good, borderColor: POSITIVE_COLOR, backgroundColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 6, tension: 0, order: 1 },
                                { label: '부정 평가', data: d.pres_bad, borderColor: NEGATIVE_COLOR, backgroundColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 6, tension: 0, order: 2 }
                            ];
                            if (!presChartFull) presChartFull = initChart('presChartFull', monthlyMainData.labels, ds, 0, 90);
                            else {
                                presChartFull.data.labels = monthlyMainData.labels;
                                presChartFull.data.datasets = ds;
                                presChartFull.update();
                            }
                        });
                    } else {
                        // 이미 로드됨
                        const d = monthlyMainData.data;
                        const ds = [
                            { label: '긍정 평가', data: d.pres_good, borderColor: POSITIVE_COLOR, backgroundColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 6, tension: 0, order: 1 },
                            { label: '부정 평가', data: d.pres_bad, borderColor: NEGATIVE_COLOR, backgroundColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 6, tension: 0, order: 2 }
                        ];
                        if (!presChartFull) presChartFull = initChart('presChartFull', monthlyMainData.labels, ds, 0, 90);
                        else {
                            presChartFull.data.labels = monthlyMainData.labels;
                            presChartFull.data.datasets = ds;
                            presChartFull.update();
                        }
                    }
                    break;

                case 'party-slide-full': // 4페이지: 정당 월간 (CSV 사용)
                    if (!monthlyMainData) {
                        loadMonthlyMainData().then(() => {
                            const d = monthlyMainData.data;
                            const ds = [
                                { label: '민주당', data: d.party_dem, borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 1 },
                                { label: '국민의힘', data: d.party_con, borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 2 },
                                { label: '무당층', data: d.party_none, borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, tension: 0, order: 3 }
                            ];
                            if (!partyChartFull) partyChartFull = initChart('partyChartFull', monthlyMainData.labels, ds, 0, 50);
                            else {
                                partyChartFull.data.labels = monthlyMainData.labels;
                                partyChartFull.data.datasets = ds;
                                partyChartFull.update();
                            }
                        });
                    } else {
                        const d = monthlyMainData.data;
                        const ds = [
                            { label: '민주당', data: d.party_dem, borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 1 },
                            { label: '국민의힘', data: d.party_con, borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 2 },
                            { label: '무당층', data: d.party_none, borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, tension: 0, order: 3 }
                        ];
                        if (!partyChartFull) partyChartFull = initChart('partyChartFull', monthlyMainData.labels, ds, 0, 50);
                        else {
                            partyChartFull.data.labels = monthlyMainData.labels;
                            partyChartFull.data.datasets = ds;
                            partyChartFull.update();
                        }
                    }
                    break;

                case 'pres-slide': { // 5페이지: 직무 세부 (CSV 사용)
                    if (!monthlyDetailedData) {
                        loadMonthlyDetailedData().then(() => {
                            const currentActiveBtn = pres_controls?.querySelector('.btn.active');
                            updatePresView(currentActiveBtn ? (currentActiveBtn.dataset.mode || 'total') : 'total', currentActiveBtn);
                        });
                    } else {
                        const currentActiveBtn = pres_controls?.querySelector('.btn.active');
                        updatePresView(currentActiveBtn ? (currentActiveBtn.dataset.mode || 'total') : 'total', currentActiveBtn);
                    }
                    break;
                }

                case 'party-slide': // 6페이지: 정당 세부 (CSV, MainData 잘라쓰기)
                    if (!monthlyMainData) {
                        loadMonthlyMainData().then(() => {
                            // 최근 3개월만
                            const totalLen = monthlyMainData.labels.length;
                            const startIdx = Math.max(0, totalLen - 3);
                            const partialLabels = monthlyMainData.labels.slice(startIdx);
                            const d = monthlyMainData.data;

                            const ds = [
                                { label: '민주당', data: d.party_dem.slice(startIdx), borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 1 },
                                { label: '국민의힘', data: d.party_con.slice(startIdx), borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 2 },
                                { label: '무당층', data: d.party_none.slice(startIdx), borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, tension: 0, order: 3 }
                            ];

                            if (!partyChart) partyChart = initChart('partyChart', partialLabels, ds, 0, 50, false);
                            else {
                                partyChart.data.labels = partialLabels;
                                partyChart.data.datasets = ds;
                                partyChart.update();
                            }
                        });
                    } else {
                        const totalLen = monthlyMainData.labels.length;
                        const startIdx = Math.max(0, totalLen - 3);
                        const partialLabels = monthlyMainData.labels.slice(startIdx);
                        const d = monthlyMainData.data;

                        const ds = [
                            { label: '민주당', data: d.party_dem.slice(startIdx), borderColor: POSITIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 1 },
                            { label: '국민의힘', data: d.party_con.slice(startIdx), borderColor: NEGATIVE_COLOR, borderWidth: 3, pointRadius: 5, tension: 0, order: 2 },
                            { label: '무당층', data: d.party_none.slice(startIdx), borderColor: NON_PARTISAN_COLOR, borderWidth: 2, borderDash: [5, 5], pointRadius: 4, tension: 0, order: 3 }
                        ];

                        if (!partyChart) partyChart = initChart('partyChart', partialLabels, ds, 0, 50, false);
                        else {
                            partyChart.data.labels = partialLabels;
                            partyChart.data.datasets = ds;
                            partyChart.update();
                        }
                    }
                    break;

                case 'policy-title-slide': // (삭제됨)
                    break;
                case 'slide-yk-1': // (삭제됨)
                case 'slide-yk-2': // (삭제됨)
                case 'slide-yk-3': // (삭제됨)
                    break;

                case 'slide-new-1':
                    if (!chartNew1) chartNew1 = createChartNew1();
                    else chartNew1.update();
                    break;
                case 'slide-new-2-1':
                    if (!chartNew2_1) chartNew2_1 = createChartNew2_1();
                    else chartNew2_1.update();
                    break;
                case 'slide-new-2-2':
                    if (!chartNew2_2) chartNew2_2 = createChartNew2_2();
                    else chartNew2_2.update();
                    break;
                case 'slide-new-2-3':
                    if (!chartNew2_3) chartNew2_3 = createChartNew2_3();
                    else chartNew2_3.update();
                    break;
                case 'slide-new-3':
                    if (!chartNew3) chartNew3 = createChartNew3();
                    else chartNew3.update();
                    break;
                case 'slide-new-4':
                    if (!chartNew4) chartNew4 = createChartNew4();
                    else updateNew4View(document.querySelector('#new4-controls .btn.active')?.dataset.mode || 'total', null);
                    // ^ updateNew4View calls destroy/create internally so simple update might need care, 
                    // but our structure allows calling updateNew4View safely.
                    break;
                case 'slide-new-4-1':
                    if (!chartNew4_1) chartNew4_1 = createChartNew4_1();
                    else chartNew4_1.update();
                    break;
                case 'slide-new-4-2':
                    if (!chartNew4_2) {
                        chartNew4_2 = createChartNew4_2();
                    } else {
                        // Re-trigger view update if needed or just let it be.
                        // Keeping it simple since updateNew4_2View handles destroy/create
                        // We can just call update with current mode if we stored it, or default.
                        const activeBtn = document.querySelector('#new4-2-controls .btn.active');
                        updateNew4_2View(activeBtn ? activeBtn.dataset.mode || 'total' : 'total', null);
                    }
                    break;
                case 'slide-new-5':
                    if (!chartNew5) chartNew5 = createChartNew5();
                    else chartNew5.update();
                    break;
                case 'slide-new-6':
                    if (electionTrustData.length === 0) {
                        loadElectionTrustData();
                    } else if (!chartNew6) {
                        renderConspiracyBarChart();
                    }
                    break;

                // Title Slides (No charts)
                case 'title-part2':
                case 'title-part3':
                    break;

                // Old cases for cleanup safety (can be removed or left as dead code)
                case 'policy-econ-slide':
                case 'policy-negative-exp-slide':
                case 'policy-risk-slide':
                case 'policy-welfare-slide':
                case 'policy-solution-slide':
                    break;

                default:
                    // 혹시 slideOrder에 새 ID를 추가했는데 case를 빼먹어도, 화면은 나오게 두기
                    console.warn(`[updateSlideDisplay] switch 처리되지 않은 슬라이드: ${slideId}`);
                    break;
            }
        }


        // ⭐️ 화살표를 통한 슬라이드 이동 함수
        function navigateSlides(direction) {
            let newIndex = currentSlideIndex + direction;

            if (newIndex >= 0 && newIndex < slideOrder.length) {
                currentSlideIndex = newIndex;
                updateSlideDisplay(currentSlideIndex);
            }
        }

        // 초기 로드 시 첫 번째 슬라이드 활성화
        document.addEventListener('DOMContentLoaded', () => {
            updateSlideDisplay(currentSlideIndex);
        });

        document.addEventListener('keydown', (e) => {
            // ← 왼쪽 화살표
            if (e.key === 'ArrowLeft') {
                navigateSlides(-1);
            }

            // → 오른쪽 화살표
            if (e.key === 'ArrowRight') {
                navigateSlides(1);
            }

            // PageUp / PageDown도 지원 (선택)
            if (e.key === 'PageUp') {
                navigateSlides(-1);
            }
            if (e.key === 'PageDown') {
                navigateSlides(1);
            }
        });
    </script>

</body>

</html>