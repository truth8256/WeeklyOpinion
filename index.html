<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 프레젠테이션 슬라이드 (총 5페이지)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
        }

        /* ⭐️ 프레젠테이션 뷰를 감싸는 래퍼 (고정 크기 유지) */
        .presentation-wrapper {
            width: 960px;
            height: 540px;
            position: relative; 
        }

        /* 슬라이드 컨테이너 */
        .slide-container {
            width: 100%;
            height: 100%;
            background-color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: absolute; 
            top: 0;
            left: 0;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s, visibility 0.3s;
        }

        /* 숨겨진 슬라이드 */
        .slide-container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* 최소화된 슬라이드 내비게이터 (슬라이드 바깥 우측 하단) */
        .slide-navigator {
            position: absolute;
            bottom: -40px; 
            right: 0;     
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 20;   
        }

        .nav-arrow {
            background: none;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
        }

        .nav-arrow:hover:not(:disabled) {
            background-color: #e9ecef;
            border-color: #c0c0c0;
        }

        .nav-arrow:disabled {
            color: #ccc;
            cursor: default;
            border-color: #eee;
        }

        #page-indicator {
            font-size: 14px;
            color: #666;
        }

        /* 기존 스타일 유지 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 15px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .title {
            font-size: 24px;
            font-weight: 800;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #e9ecef;
        }

        .btn.active {
            background-color: #0056b3;
            color: white;
            border-color: #0056b3;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
            width: 100%;
            height: 100%;
        }
        
    </style>
</head>
<body>

    <div class="presentation-wrapper">
        
        <div class="slide-navigator">
            <button id="nav-prev" class="nav-arrow" onclick="navigateSlides(-1)" disabled>&lt;</button>
            <span id="page-indicator">1 / 5</span>
            <button id="nav-next" class="nav-arrow" onclick="navigateSlides(1)">&gt;</button>
        </div>

        <div id="weekly-trend-slide" class="slide-container">
            <div class="header">
                <div id="weekly-trend-title" class="title">대통령 직무 수행 평가 추이 (갤럽)</div>
                <div class="subtitle">기간: 주간 단위 | 자료: 갤럽/리얼미터</div>
            </div>

            <div id="weekly-trend-controls" class="controls">
                <button class="btn active" data-mode="gallup" onclick="updateWeeklyTrendView('gallup', this)">갤럽</button>
                <button class="btn" data-mode="realmeter" onclick="updateWeeklyTrendView('realmeter', this)">리얼미터</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="weeklyTrendChart"></canvas>
            </div>
        </div>

        <div id="pres-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div> 

            <div class="chart-wrapper">
                <canvas id="presChartFull"></canvas>
            </div>
        </div>

        <div id="party-slide-full" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (월별 통합)</div>
                <div class="subtitle">기간: 2025년 7월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div class="controls" style="height: 35px;"></div>

            <div class="chart-wrapper">
                <canvas id="partyChartFull"></canvas>
            </div>
        </div>

        <div id="pres-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">대통령 직무 수행 평가 추이 (월별통합, 긍정) - 세부 비교</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="pres-controls" class="controls">
                <button class="btn active" data-mode="total" onclick="updatePresView('total', this)">전체 보기</button>
                <button class="btn" data-mode="gender" onclick="updatePresView('gender', this)">성별</button>
                <button class="btn" data-mode="age" onclick="updatePresView('age', this)">연령별</button>
                <button class="btn" data-mode="region_main" onclick="updatePresView('region_main', this)">주요 지역별</button>
                <button class="btn" data-mode="gender_age_2030" onclick="updatePresView('gender_age_2030', this)">성/연령별 (2030)</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="presChart"></canvas>
            </div>

        </div>

        <div id="party-slide" class="slide-container hidden">
            <div class="header">
                <div class="title">주요 정당 지지율 추이 (민주당, 국민의힘, 무당층) - 세부</div>
                <div class="subtitle">기간: 2025년 9월 ~ 11월 | 자료: 한국갤럽</div>
            </div>

            <div id="party-controls" class="controls">
                <button class="btn active" disabled>전체 보기</button>
            </div>

            <div class="chart-wrapper">
                <canvas id="partyChart"></canvas>
            </div>
        </div>

    </div>

    <script>
        // 전체 기간 (7월, 8월, 9월, 10월, 11월)
        const labelsFull = ['7월', '8월', '9월', '10월', '11월'];
        // 기존 기간 (9월, 10월, 11월)
        const labelsPartial = ['9월', '10월', '11월'];
        
        // --- 차트 데이터 및 객체 ---
        let presChartFull = null; 
        let partyChartFull = null; 
        let presChart = null; 
        let partyChart = null; 
        
        // ⭐️ 새로운 변수 추가
        let weeklyTrendChart = null; // 주간 국정수행평가 차트 객체
        let weeklyTrendData = {};    // 주간 국정수행평가 데이터 저장소
        
        const pres_controls = document.getElementById('pres-controls');
        
        // ⭐️ 슬라이드 순서 및 상태 관리 (총 5개로 증가)
        const slideOrder = ['weekly-trend-slide', 'pres-slide-full', 'party-slide-full', 'pres-slide', 'party-slide'];
        let currentSlideIndex = 0;
        const pageIndicator = document.getElementById('page-indicator');
        const navPrev = document.getElementById('nav-prev');
        const navNext = document.getElementById('nav-next');


        // ===========================================================
        // 2, 3 페이지 데이터 (7월~11월, 5개월 추이)
        // ===========================================================

        // [2페이지: 직무 평가 전체 데이터 - 긍정/부정]
        const pres_data_Full = [
            { 
                label: '긍정 평가', 
                data: [64, 58, 59, 56, 60], // 7월, 8월, 9월, 10월, 11월
                borderColor: '#0056b3',
                backgroundColor: '#0056b3',
                borderWidth: 3,
                pointRadius: 6,
                pointHoverRadius: 8,
                tension: 0,
                order: 1
            },
            {
                label: '부정 평가',
                data: [23, 32, 32, 34, 30], // 7월, 8월, 9월, 10월, 11월
                borderColor: '#C9151E',
                backgroundColor: '#C9151E',
                borderWidth: 3,
                pointRadius: 6,
                pointHoverRadius: 8,
                tension: 0,
                order: 2
            }
        ];

        // [3페이지: 정당 지지율 데이터 - 7월 포함]
        const partyData_Full = [
            { label: '민주당', data: [45, 43, 40, 41, 42], borderColor: '#0056b3', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 }, 
            { label: '국민의힘', data: [20, 23, 24, 25, 25], borderColor: '#C9151E', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 }, 
            { label: '무당층', data: [25, 25, 27, 26, 26], borderColor: '#666666', borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 } 
        ];

        // ... (4, 5페이지 데이터는 그대로 유지) ...
        const pres_totalData_Partial = {
             label: '직무 평가 전체',
             data: [59, 56, 60], // 9월, 10월, 11월 (긍정 평가만 표시)
             borderColor: '#000000',
             backgroundColor: '#000000',
             borderWidth: 2,
             pointRadius: 5,
             pointHoverRadius: 7,
             tension: 0,
             order: 1
        };
        const pres_categories_Partial = {
            'total': [],
            'gender': [
                { label: '남성', data: [56, 56, 60], borderColor: '#36A2EB', borderWidth: 2 },
                { label: '여성', data: [62, 56, 61], borderColor: '#FF6384', borderWidth: 2 }
            ],
            'age': [
                { label: '18~29세', data: [43, 41, 51], borderColor: '#4BC0C0', borderWidth: 2 },
                { label: '30대', data: [62, 51, 57], borderColor: '#FF9F40', borderWidth: 2 },
                { label: '40대', data: [75, 74, 76], borderColor: '#9966FF', borderWidth: 2 },
                { label: '50대', data: [71, 70, 72], borderColor: '#FFCD56', borderWidth: 2 },
                { label: '60대', data: [53, 47, 55], borderColor: '#C9CBCF', borderWidth: 2 },
                { label: '70대 이상', data: [44, 46, 47], borderColor: '#8c8c8c', borderWidth: 2, borderDash: [5, 5] }
            ],
            'region_main': [
                { label: '서울', data: [60, 50, 61], borderColor: '#E91E63', borderWidth: 3 },
                { label: '인천/경기', data: [61, 58, 60], borderColor: '#3F51B5', borderWidth: 2 },
                { label: '대구/경북', data: [41, 40, 45], borderColor: '#009688', borderWidth: 2 },
                { label: '부산/울산/경남', data: [51, 52, 56], borderColor: '#795548', borderWidth: 2 },
                { label: '광주/전라', data: [84, 80, 85], borderColor: '#4CAF50', borderWidth: 2, borderDash: [5, 5] }
            ],
            'gender_age_2030': [
                { label: '남성 20대', data: [30, 32, 45], borderColor: '#2980b9', borderWidth: 2, borderDash: [5, 2] },
                { label: '여성 20대', data: [57, 52, 58], borderColor: '#e74c3c', borderWidth: 2, borderDash: [5, 2] },
                { label: '남성 30대', data: [52, 48, 52], borderColor: '#3498db', borderWidth: 2 },
                { label: '여성 30대', data: [74, 55, 63], borderColor: '#e67e22', borderWidth: 2 }
            ]
        };
        const partyData_Partial = [
            { label: '민주당', data: [40, 41, 42], borderColor: '#0056b3', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 1 },
            { label: '국민의힘', data: [24, 25, 25], borderColor: '#C9151E', borderWidth: 3, pointRadius: 5, pointHoverRadius: 7, tension: 0, order: 2 },
            { label: '무당층', data: [27, 26, 26], borderColor: '#666666', borderWidth: 2, borderDash: [5, 5], pointRadius: 4, pointHoverRadius: 6, tension: 0, order: 3 }
        ];

        // -----------------------------------------------------------
        // ⭐️ 1페이지 주간 데이터 로직 (parse, load)
        // -----------------------------------------------------------

        function parseCombinedCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const labels = [];
            const gallupData = { good: [], bad: [] };
            const realmeterData = { good: [], bad: [] };

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    labels.push(values[0].trim()); // week (X축 라벨)
                    
                    // realmeter 데이터 (인덱스 1, 2)
                    realmeterData.good.push(parseInt(values[1].trim()));
                    realmeterData.bad.push(parseInt(values[2].trim()));

                    // gallup 데이터 (인덱스 4, 5)
                    gallupData.good.push(parseInt(values[4].trim()));
                    gallupData.bad.push(parseInt(values[5].trim()));
                }
            }
            return { labels, gallupData, realmeterData };
        }

        function loadWeeklyTrendChart() {
            const DATA_URL = './data/presidential_approval_real_gal.csv'; 

            fetch(DATA_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('주간 추이 데이터 로드 실패: ' + response.statusText);
                    }
                    return response.text();
                })
                .then(csvText => {
                    weeklyTrendData = parseCombinedCSV(csvText);
                    
                    // 초기 차트 (갤럽) 렌더링
                    updateWeeklyTrendView('gallup', document.querySelector('#weekly-trend-controls .btn.active'));
                })
                .catch(error => {
                    console.error("주간 추이 데이터 로드 오류:", error);
                });
        }

        // -----------------------------------------------------------
        // ⭐️ 차트 초기화 함수 (재사용)
        //
